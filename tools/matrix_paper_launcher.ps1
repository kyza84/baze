param(
  [ValidateSet('1','2','3','4')]
  [string]$Count = '2',
  [string[]]$ProfileIds = @(),
  [ValidateSet('shared','split')]
  [string]$ShardMode = 'shared',
  [switch]$Run
)

$ErrorActionPreference = 'Stop'
$root = Resolve-Path (Join-Path $PSScriptRoot '..')
Set-Location $root

$python = Join-Path $root '.venv\Scripts\python.exe'
if (-not (Test-Path $python)) {
  throw "Python not found: $python"
}

$matrixDir = Join-Path $root 'data\matrix'
$envDir = Join-Path $matrixDir 'env'
$runDir = Join-Path $matrixDir 'runs'
New-Item -ItemType Directory -Force -Path $matrixDir, $envDir, $runDir | Out-Null

if ($Run) {
  $stopper = Join-Path $PSScriptRoot 'matrix_paper_stop.ps1'
  if (Test-Path $stopper) {
    & powershell -NoProfile -ExecutionPolicy Bypass -File $stopper -HardKill | Out-Null
    Start-Sleep -Seconds 1
  }
  # Ensure we do not mix matrix with stale single/main_local workers.
  $existing = Get-CimInstance Win32_Process -Filter "name='python.exe'" -ErrorAction SilentlyContinue |
    Where-Object { [string]$_.CommandLine -match 'main_local\.py' } |
    Select-Object -ExpandProperty ProcessId
  foreach ($procId in @($existing)) {
    try { Stop-Process -Id ([int]$procId) -Force -ErrorAction SilentlyContinue } catch {}
  }
  Start-Sleep -Milliseconds 800

  # Ensure unified dataset sync worker is running (single process, incremental deduped ingest).
  $syncScript = Join-Path $PSScriptRoot 'unified_dataset_sync.py'
  if (Test-Path $syncScript) {
    $syncExisting = Get-CimInstance Win32_Process -Filter "name='python.exe'" -ErrorAction SilentlyContinue |
      Where-Object { [string]$_.CommandLine -match 'tools[\\\/]unified_dataset_sync\.py' -and [string]$_.CommandLine -match '--follow' }
    foreach ($proc in @($syncExisting)) {
      $syncPid = 0
      try { $syncPid = [int]$proc.ProcessId } catch { $syncPid = 0 }
      if ($syncPid -gt 0) {
        try {
          Stop-Process -Id $syncPid -Force -ErrorAction SilentlyContinue
          Write-Host ("Unified dataset sync restarted: stopped stale pid={0}" -f $syncPid)
        } catch {}
      }
    }
    try {
      $syncPsi = New-Object System.Diagnostics.ProcessStartInfo
      $syncPsi.FileName = $python
      $syncPsi.Arguments = "tools/unified_dataset_sync.py --root . --follow --loop-seconds 45"
      $syncPsi.WorkingDirectory = $root
      $syncPsi.UseShellExecute = $false
      $syncPsi.RedirectStandardOutput = $false
      $syncPsi.RedirectStandardError = $false
      $syncProc = [System.Diagnostics.Process]::Start($syncPsi)
      if ($syncProc -and -not $syncProc.HasExited) {
        Write-Host ("Unified dataset sync started pid={0}" -f [int]$syncProc.Id)
      }
    } catch {
      Write-Warning ("Failed to start unified dataset sync: {0}" -f $_.Exception.Message)
    }
  }

  # Ensure matrix watchdog is running: restarts stale workers by heartbeat.
  $watchdogScript = Join-Path $PSScriptRoot 'matrix_watchdog.py'
  if (Test-Path $watchdogScript) {
    $wdExisting = Get-CimInstance Win32_Process -Filter "name='python.exe'" -ErrorAction SilentlyContinue |
      Where-Object { [string]$_.CommandLine -match 'tools[\\\/]matrix_watchdog\.py' -and [string]$_.CommandLine -match '--follow' }
    foreach ($proc in @($wdExisting)) {
      $wdPid = 0
      try { $wdPid = [int]$proc.ProcessId } catch { $wdPid = 0 }
      if ($wdPid -gt 0) {
        try {
          Stop-Process -Id $wdPid -Force -ErrorAction SilentlyContinue
          Write-Host ("Matrix watchdog restarted: stopped stale pid={0}" -f $wdPid)
        } catch {}
      }
    }
    try {
      $wdPsi = New-Object System.Diagnostics.ProcessStartInfo
      $wdPsi.FileName = $python
      $wdPsi.Arguments = "tools/matrix_watchdog.py --root . --follow --loop-seconds 20 --stale-seconds 180 --restart-cooldown-seconds 120"
      $wdPsi.WorkingDirectory = $root
      $wdPsi.UseShellExecute = $false
      $wdPsi.RedirectStandardOutput = $false
      $wdPsi.RedirectStandardError = $false
      $wdProc = [System.Diagnostics.Process]::Start($wdPsi)
      if ($wdProc -and -not $wdProc.HasExited) {
        Write-Host ("Matrix watchdog started pid={0}" -f [int]$wdProc.Id)
      }
    } catch {
      Write-Warning ("Failed to start matrix watchdog: {0}" -f $_.Exception.Message)
    }
  }
}

function Test-MainLocalProcess {
  param(
    [int]$ProcessId
  )
  if ($ProcessId -le 0) { return $false }
  try {
    $proc = Get-CimInstance Win32_Process -Filter "ProcessId=$ProcessId" -ErrorAction SilentlyContinue
    if (-not $proc) { return $false }
    $cmd = [string]$proc.CommandLine
    if ($cmd -notmatch 'main_local\.py') { return $false }
    return $true
  } catch {
    return $false
  }
}

# Variant matrix:
# - mx1_flow_balanced: stable high-flow profile (more quality guards, steady exits).
# - mx2_flow_aggressive: higher-throughput profile (more entries, faster recycle).
# - mx3_flow_compound / mx4_flow_guarded: winner-derived forks.
# - mx5_mode_guarded / mx6_mode_flow: mx3-based parity tests for new market-mode controllers.
# - mx11_baseline_adapted: current golden baseline for controlled A/B runs.
$variants = @(
  @{ name='mx1_flow_balanced'; overrides=@{
      ADAPTIVE_FILTERS_ENABLED='true';
      ADAPTIVE_FILTERS_MODE='apply';
      ADAPTIVE_FILTERS_INTERVAL_SECONDS='240';
      ADAPTIVE_FILTERS_MIN_WINDOW_CYCLES='2';
      ADAPTIVE_FILTERS_COOLDOWN_WINDOWS='0';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.8';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='10.0';
      ADAPTIVE_FILTERS_TARGET_OPEN_MIN='0.15';
      ADAPTIVE_ZERO_OPEN_RESET_ENABLED='true';
      ADAPTIVE_ZERO_OPEN_WINDOWS_BEFORE_RESET='1';
      ADAPTIVE_ZERO_OPEN_MIN_CANDIDATES='0.6';
      ADAPTIVE_SCORE_MIN='50';
      ADAPTIVE_SCORE_MAX='58';
      ADAPTIVE_SAFE_VOLUME_MIN='45';
      ADAPTIVE_SAFE_VOLUME_MAX='160';
      ADAPTIVE_EDGE_MIN='0.75';
      ADAPTIVE_EDGE_MAX='1.30';
      ADAPTIVE_DEDUP_TTL_MIN='20';
      ADAPTIVE_DEDUP_TTL_MAX='90';
      ADAPTIVE_DEDUP_RELAX_ENABLED='true';
      ADAPTIVE_DEDUP_DYNAMIC_ENABLED='true';
      ADAPTIVE_DEDUP_DYNAMIC_MIN='8';
      ADAPTIVE_DEDUP_DYNAMIC_MAX='24';
      ADAPTIVE_DEDUP_DYNAMIC_TARGET_PERCENTILE='90';
      ADAPTIVE_DEDUP_DYNAMIC_FACTOR='1.15';
      ADAPTIVE_DEDUP_DYNAMIC_MIN_SAMPLES='150';
      WALLET_MODE='paper';
      AUTO_TRADE_ENABLED='true';
      AUTO_TRADE_PAPER='true';
      AUTO_TRADE_EXCLUDED_SYMBOLS='ZORA';
      ONCHAIN_ENABLE_UNISWAP_V3='true';
      DEX_SEARCH_QUERIES='base,eth,usdc,cbbtc,aero,virtual,bridged,ai,defi,memes';
      DEX_BOOSTS_MAX_TOKENS='35';
      AUTO_TRADE_ENTRY_MODE='top_n';
      AUTO_TRADE_TOP_N='10';
      AUTONOMOUS_CONTROL_ENABLED='true';
      AUTONOMOUS_CONTROL_MODE='apply';
      AUTONOMOUS_CONTROL_INTERVAL_SECONDS='300';
      AUTONOMOUS_CONTROL_MIN_WINDOW_CYCLES='2';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.5';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='6.0';
      AUTONOMOUS_CONTROL_TARGET_OPENED_MIN='0.15';
      AUTONOMOUS_CONTROL_NEG_REALIZED_TRIGGER_USD='0.05';
      AUTONOMOUS_CONTROL_POS_REALIZED_TRIGGER_USD='0.05';
      AUTONOMOUS_CONTROL_MAX_LOSS_STREAK_TRIGGER='3';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MIN='2';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='4';
      AUTONOMOUS_CONTROL_TOP_N_MIN='8';
      AUTONOMOUS_CONTROL_TOP_N_MAX='14';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MIN='20';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='48';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MIN='0.65';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MAX='1.05';
      AUTONOMOUS_CONTROL_RISK_OFF_OPEN_TRADES_CAP='2';
      AUTONOMOUS_CONTROL_RISK_OFF_TOP_N_CAP='8';
      AUTONOMOUS_CONTROL_RISK_OFF_MAX_BUYS_PER_HOUR_CAP='24';
      AUTONOMOUS_CONTROL_RISK_OFF_TRADE_SIZE_MAX_CAP='0.70';
      PROFIT_LOCK_TRIGGER_PERCENT='3.5';
      PROFIT_LOCK_FLOOR_PERCENT='1.0';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='14';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.35';
      PAPER_PARTIAL_TP_ENABLED='true';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.8';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.30';
      PAPER_PARTIAL_TP_MOVE_SL_TO_BREAK_EVEN='true';
      PAPER_PARTIAL_TP_BREAK_EVEN_BUFFER_PERCENT='0.10';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='18';
      WEAKNESS_EXIT_PNL_PERCENT='-2.8';
      PAPER_MAX_HOLD_SECONDS='240';
      MIN_EXPECTED_EDGE_PERCENT='0.60';
      MIN_EXPECTED_EDGE_USD='0.015';
      EDGE_FILTER_MODE='both';
      MIN_TOKEN_SCORE='52';
      SAFE_TEST_MODE='true';
      SAFE_MIN_VOLUME_5M_USD='60';
      SAFE_MIN_LIQUIDITY_USD='6000';
      SAFE_MIN_AGE_SECONDS='240';
      SAFE_REQUIRE_RISK_LEVEL='MEDIUM';
      SAFE_REQUIRE_CONTRACT_SAFE='true';
      SAFE_MAX_WARNING_FLAGS='1';
      TOKEN_SAFETY_FAIL_CLOSED='true';
      HONEYPOT_API_ENABLED='true';
      HONEYPOT_API_FAIL_CLOSED='true';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='25';
      STOP_LOSS_PERCENT='4';
      MAX_BUYS_PER_HOUR='36';
      MAX_TOKEN_COOLDOWN_SECONDS='90';
      RISK_GOVERNOR_MAX_LOSS_STREAK='4';
      RISK_GOVERNOR_STREAK_PAUSE_SECONDS='300';
      RISK_GOVERNOR_DRAWDOWN_LIMIT_PERCENT='5';
      RISK_GOVERNOR_DRAWDOWN_PAUSE_SECONDS='1200';
      PNL_BREAKEVEN_EPSILON_USD='0.001';
      MAX_OPEN_TRADES='3';
      PAPER_TRADE_SIZE_MIN_USD='0.50';
      PAPER_TRADE_SIZE_MAX_USD='0.95';
      AUTOTRADE_BLACKLIST_TTL_SECONDS='10800';
      PAPER_RESET_ON_START='true';
      ENTRY_REQUIRE_POSITIVE_CHANGE_5M='false';
      ENTRY_MIN_PRICE_CHANGE_5M_PERCENT='-0.25';
      ENTRY_REQUIRE_VOLUME_BUFFER='true';
      ENTRY_MIN_VOLUME_5M_MULT='1.10';
      WALLET_BALANCE_USD='7.00';
      DYNAMIC_HOLD_ENABLED='true';
      HOLD_MIN_SECONDS='45';
      HOLD_MAX_SECONDS='210';
    }
  },
  @{ name='mx2_flow_aggressive'; overrides=@{
      ADAPTIVE_FILTERS_ENABLED='true';
      ADAPTIVE_FILTERS_MODE='apply';
      ADAPTIVE_FILTERS_INTERVAL_SECONDS='180';
      ADAPTIVE_FILTERS_COOLDOWN_WINDOWS='0';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='2.5';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='16.0';
      ADAPTIVE_FILTERS_TARGET_OPEN_MIN='0.22';
      ADAPTIVE_ZERO_OPEN_RESET_ENABLED='true';
      ADAPTIVE_ZERO_OPEN_WINDOWS_BEFORE_RESET='1';
      ADAPTIVE_ZERO_OPEN_MIN_CANDIDATES='0.4';
      ADAPTIVE_SCORE_MIN='50';
      ADAPTIVE_SCORE_MAX='56';
      ADAPTIVE_SAFE_VOLUME_MIN='30';
      ADAPTIVE_SAFE_VOLUME_MAX='130';
      ADAPTIVE_EDGE_MIN='0.60';
      ADAPTIVE_EDGE_MAX='1.05';
      ADAPTIVE_DEDUP_TTL_MIN='12';
      ADAPTIVE_DEDUP_TTL_MAX='45';
      ADAPTIVE_DEDUP_RELAX_ENABLED='true';
      ADAPTIVE_DEDUP_DYNAMIC_ENABLED='true';
      ADAPTIVE_DEDUP_DYNAMIC_MIN='6';
      ADAPTIVE_DEDUP_DYNAMIC_MAX='16';
      ADAPTIVE_DEDUP_DYNAMIC_TARGET_PERCENTILE='90';
      ADAPTIVE_DEDUP_DYNAMIC_FACTOR='1.20';
      ADAPTIVE_DEDUP_DYNAMIC_MIN_SAMPLES='120';
      WALLET_MODE='paper';
      AUTO_TRADE_ENABLED='true';
      AUTO_TRADE_PAPER='true';
      AUTO_TRADE_EXCLUDED_SYMBOLS='ZORA';
      ONCHAIN_ENABLE_UNISWAP_V3='true';
      DEX_SEARCH_QUERIES='base,eth,usdc,cbbtc,aero,virtual';
      AUTO_TRADE_ENTRY_MODE='top_n';
      AUTO_TRADE_TOP_N='12';
      AUTONOMOUS_CONTROL_ENABLED='true';
      AUTONOMOUS_CONTROL_MODE='apply';
      AUTONOMOUS_CONTROL_INTERVAL_SECONDS='240';
      AUTONOMOUS_CONTROL_MIN_WINDOW_CYCLES='2';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='2.0';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='8.5';
      AUTONOMOUS_CONTROL_TARGET_OPENED_MIN='0.20';
      AUTONOMOUS_CONTROL_NEG_REALIZED_TRIGGER_USD='0.06';
      AUTONOMOUS_CONTROL_POS_REALIZED_TRIGGER_USD='0.06';
      AUTONOMOUS_CONTROL_MAX_LOSS_STREAK_TRIGGER='3';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MIN='2';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='5';
      AUTONOMOUS_CONTROL_TOP_N_MIN='8';
      AUTONOMOUS_CONTROL_TOP_N_MAX='16';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MIN='24';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='72';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MIN='0.60';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MAX='0.95';
      AUTONOMOUS_CONTROL_RISK_OFF_OPEN_TRADES_CAP='2';
      AUTONOMOUS_CONTROL_RISK_OFF_TOP_N_CAP='8';
      AUTONOMOUS_CONTROL_RISK_OFF_MAX_BUYS_PER_HOUR_CAP='24';
      AUTONOMOUS_CONTROL_RISK_OFF_TRADE_SIZE_MAX_CAP='0.70';
      PROFIT_LOCK_TRIGGER_PERCENT='2.4';
      PROFIT_LOCK_FLOOR_PERCENT='0.8';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='10';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.30';
      PAPER_PARTIAL_TP_ENABLED='true';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.1';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.40';
      PAPER_PARTIAL_TP_MOVE_SL_TO_BREAK_EVEN='true';
      PAPER_PARTIAL_TP_BREAK_EVEN_BUFFER_PERCENT='0.10';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='14';
      WEAKNESS_EXIT_PNL_PERCENT='-2.9';
      PAPER_MAX_HOLD_SECONDS='160';
      MIN_EXPECTED_EDGE_PERCENT='0.60';
      MIN_EXPECTED_EDGE_USD='0.015';
      EDGE_FILTER_MODE='both';
      MIN_TOKEN_SCORE='50';
      SAFE_TEST_MODE='true';
      SAFE_MIN_VOLUME_5M_USD='55';
      SAFE_MIN_LIQUIDITY_USD='6000';
      SAFE_MIN_AGE_SECONDS='210';
      SAFE_REQUIRE_RISK_LEVEL='MEDIUM';
      SAFE_REQUIRE_CONTRACT_SAFE='true';
      SAFE_MAX_WARNING_FLAGS='1';
      TOKEN_SAFETY_FAIL_CLOSED='true';
      HONEYPOT_API_ENABLED='true';
      HONEYPOT_API_FAIL_CLOSED='true';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='12';
      STOP_LOSS_PERCENT='4';
      MAX_BUYS_PER_HOUR='56';
      MAX_TOKEN_COOLDOWN_SECONDS='60';
      RISK_GOVERNOR_MAX_LOSS_STREAK='4';
      RISK_GOVERNOR_STREAK_PAUSE_SECONDS='300';
      RISK_GOVERNOR_DRAWDOWN_LIMIT_PERCENT='5';
      RISK_GOVERNOR_DRAWDOWN_PAUSE_SECONDS='900';
      PNL_BREAKEVEN_EPSILON_USD='0.001';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.45';
      PAPER_TRADE_SIZE_MAX_USD='0.85';
      AUTOTRADE_BLACKLIST_TTL_SECONDS='10800';
      PAPER_RESET_ON_START='true';
      ENTRY_REQUIRE_POSITIVE_CHANGE_5M='false';
      ENTRY_MIN_PRICE_CHANGE_5M_PERCENT='-0.25';
      ENTRY_REQUIRE_VOLUME_BUFFER='true';
      ENTRY_MIN_VOLUME_5M_MULT='1.00';
      WALLET_BALANCE_USD='7.00';
      DYNAMIC_HOLD_ENABLED='true';
      HOLD_MIN_SECONDS='30';
      HOLD_MAX_SECONDS='150';
    }
  },
  @{ name='mx3_flow_compound'; base='mx1_flow_balanced'; overrides=@{
      ADAPTIVE_FILTERS_INTERVAL_SECONDS='210';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.6';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='12.5';
      ADAPTIVE_SAFE_VOLUME_MIN='32';
      ADAPTIVE_EDGE_MIN='0.60';
      ADAPTIVE_DEDUP_TTL_MIN='8';
      ADAPTIVE_DEDUP_TTL_MAX='40';
      ADAPTIVE_DEDUP_DYNAMIC_MIN='6';
      ADAPTIVE_DEDUP_DYNAMIC_MAX='20';
      AUTO_TRADE_TOP_N='15';
      AUTONOMOUS_CONTROL_INTERVAL_SECONDS='240';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.1';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='7.5';
      AUTONOMOUS_CONTROL_TARGET_OPENED_MIN='0.10';
      AUTONOMOUS_CONTROL_NEG_REALIZED_TRIGGER_USD='0.07';
      AUTONOMOUS_CONTROL_POS_REALIZED_TRIGGER_USD='0.06';
      AUTONOMOUS_CONTROL_MAX_LOSS_STREAK_TRIGGER='4';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MIN='32';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='64';
      AUTONOMOUS_CONTROL_TOP_N_MAX='18';
      AUTONOMOUS_CONTROL_TOP_N_MIN='10';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='4';
      AUTONOMOUS_CONTROL_ANTI_STALL_ENABLED='true';
      AUTONOMOUS_CONTROL_ANTI_STALL_MIN_CANDIDATES='0.9';
      AUTONOMOUS_CONTROL_ANTI_STALL_MIN_UTILIZATION='0.80';
      AUTONOMOUS_CONTROL_ANTI_STALL_LIMIT_SKIP_MIN='1';
      AUTONOMOUS_CONTROL_ANTI_STALL_EXPAND_MULT='1.5';
      AUTONOMOUS_CONTROL_RECOVERY_ENABLED='true';
      AUTONOMOUS_CONTROL_RECOVERY_MIN_CANDIDATES='0.9';
      AUTONOMOUS_CONTROL_RECOVERY_EXPAND_MULT='1.4';
      AUTONOMOUS_CONTROL_FRAGILE_TIGHTEN_ENABLED='true';
      PROFIT_LOCK_TRIGGER_PERCENT='2.9';
      PROFIT_LOCK_FLOOR_PERCENT='0.95';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='12';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.4';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.34';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='16';
      WEAKNESS_EXIT_PNL_PERCENT='-3.0';
      PAPER_MAX_HOLD_SECONDS='195';
      MIN_TOKEN_SCORE='50';
      SAFE_MIN_VOLUME_5M_USD='44';
      MAX_BUYS_PER_HOUR='58';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.50';
      PAPER_TRADE_SIZE_MAX_USD='0.90';
      ENTRY_MIN_VOLUME_5M_MULT='1.05';
      HOLD_MIN_SECONDS='35';
      HOLD_MAX_SECONDS='175';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='10';
      MAX_TOKEN_COOLDOWN_SECONDS='180';
      DATA_POLICY_ENTER_STREAK='2';
      DATA_POLICY_EXIT_STREAK='1';
      MARKET_REGIME_FAIL_CLOSED_RATIO='32';
      MARKET_REGIME_SOURCE_ERROR_PERCENT='28';
      AUTONOMOUS_CONTROL_RISK_OFF_OPEN_TRADES_CAP='3';
      AUTONOMOUS_CONTROL_RISK_OFF_MAX_BUYS_PER_HOUR_CAP='34';
      RISK_GOVERNOR_MAX_LOSS_STREAK='5';
      RISK_GOVERNOR_STREAK_PAUSE_SECONDS='120';
      RISK_GOVERNOR_HARD_BLOCK_ON_STREAK='false';
      AUTO_TRADE_SL_REENTRY_COOLDOWN_SECONDS='1200';
      PAPER_RESET_ON_START='false';
    }
  },
  @{ name='mx4_flow_guarded'; base='mx3_flow_compound'; overrides=@{
      ADAPTIVE_FILTERS_INTERVAL_SECONDS='180';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.8';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='14.0';
      ADAPTIVE_SCORE_MIN='49';
      ADAPTIVE_SAFE_VOLUME_MIN='28';
      ADAPTIVE_EDGE_MIN='0.55';
      ADAPTIVE_DEDUP_TTL_MIN='6';
      ADAPTIVE_DEDUP_TTL_MAX='30';
      ADAPTIVE_DEDUP_DYNAMIC_MIN='5';
      ADAPTIVE_DEDUP_DYNAMIC_MAX='16';
      AUTO_TRADE_TOP_N='18';
      AUTONOMOUS_CONTROL_INTERVAL_SECONDS='210';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.6';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='9.0';
      AUTONOMOUS_CONTROL_TARGET_OPENED_MIN='0.14';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MIN='36';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='76';
      AUTONOMOUS_CONTROL_TOP_N_MIN='12';
      AUTONOMOUS_CONTROL_TOP_N_MAX='20';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='5';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MIN='0.55';
      AUTONOMOUS_CONTROL_TRADE_SIZE_MAX_MAX='0.95';
      AUTONOMOUS_CONTROL_ANTI_STALL_ENABLED='true';
      AUTONOMOUS_CONTROL_ANTI_STALL_MIN_CANDIDATES='1.0';
      AUTONOMOUS_CONTROL_ANTI_STALL_MIN_UTILIZATION='0.80';
      AUTONOMOUS_CONTROL_ANTI_STALL_LIMIT_SKIP_MIN='1';
      AUTONOMOUS_CONTROL_ANTI_STALL_EXPAND_MULT='1.6';
      AUTONOMOUS_CONTROL_RECOVERY_ENABLED='true';
      AUTONOMOUS_CONTROL_RECOVERY_MIN_CANDIDATES='1.0';
      AUTONOMOUS_CONTROL_RECOVERY_EXPAND_MULT='1.5';
      AUTONOMOUS_CONTROL_FRAGILE_TIGHTEN_ENABLED='true';
      PROFIT_LOCK_TRIGGER_PERCENT='2.6';
      PROFIT_LOCK_FLOOR_PERCENT='0.85';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='10';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.28';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.2';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.38';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='15';
      WEAKNESS_EXIT_PNL_PERCENT='-2.8';
      PAPER_MAX_HOLD_SECONDS='180';
      MIN_TOKEN_SCORE='49';
      SAFE_MIN_VOLUME_5M_USD='38';
      MAX_BUYS_PER_HOUR='66';
      MAX_OPEN_TRADES='5';
      PAPER_TRADE_SIZE_MIN_USD='0.45';
      PAPER_TRADE_SIZE_MAX_USD='0.82';
      ENTRY_REQUIRE_POSITIVE_CHANGE_5M='true';
      ENTRY_MIN_PRICE_CHANGE_5M_PERCENT='0.10';
      ENTRY_MIN_VOLUME_5M_MULT='1.00';
      HOLD_MIN_SECONDS='30';
      HOLD_MAX_SECONDS='165';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='8';
      MAX_TOKEN_COOLDOWN_SECONDS='45';
      AUTONOMOUS_CONTROL_RISK_OFF_OPEN_TRADES_CAP='3';
      AUTONOMOUS_CONTROL_RISK_OFF_MAX_BUYS_PER_HOUR_CAP='36';
      RISK_GOVERNOR_MAX_LOSS_STREAK='5';
      RISK_GOVERNOR_STREAK_PAUSE_SECONDS='90';
      RISK_GOVERNOR_HARD_BLOCK_ON_STREAK='false';
      PAPER_RESET_ON_START='false';
    }
  },
  @{ name='mx5_mode_guarded'; base='mx3_flow_compound'; overrides=@{
      # Keep new market-mode controller explicit and stricter in risk.
      MARKET_MODE_OWNS_STRICTNESS='true';
      MARKET_MODE_ENTER_STREAK='2';
      MARKET_MODE_EXIT_STREAK='4';
      MARKET_MODE_STRICT_SCORE='79';
      MARKET_MODE_SOFT_SCORE='71';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='1';
      MARKET_MODE_YELLOW_SIZE_MULT='0.72';
      MARKET_MODE_RED_SIZE_MULT='0.50';
      MARKET_MODE_YELLOW_HOLD_MULT='0.75';
      MARKET_MODE_RED_HOLD_MULT='0.55';
      MARKET_MODE_YELLOW_PARTIAL_TP_TRIGGER_MULT='0.88';
      MARKET_MODE_RED_PARTIAL_TP_TRIGGER_MULT='0.70';
      MARKET_MODE_YELLOW_PARTIAL_TP_SELL_MULT='1.25';
      MARKET_MODE_RED_PARTIAL_TP_SELL_MULT='1.45';
      MIN_TOKEN_SCORE='52';
      SAFE_MIN_VOLUME_5M_USD='50';
      AUTO_TRADE_TOP_N='12';
      MAX_BUYS_PER_HOUR='50';
      MAX_OPEN_TRADES='3';
      PAPER_TRADE_SIZE_MIN_USD='0.45';
      PAPER_TRADE_SIZE_MAX_USD='0.78';
      HOLD_MIN_SECONDS='35';
      HOLD_MAX_SECONDS='165';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.30';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.36';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.2';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='6.8';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='58';
      AUTONOMOUS_CONTROL_TOP_N_MAX='16';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='4';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.5';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='11.0';
      ADAPTIVE_SAFE_VOLUME_MIN='36';
      ADAPTIVE_SAFE_VOLUME_MAX='140';
      ADAPTIVE_EDGE_MIN='0.65';
      ADAPTIVE_DEDUP_TTL_MIN='10';
      ADAPTIVE_DEDUP_TTL_MAX='45';
      PAPER_RESET_ON_START='false';
    }
  },
  @{ name='mx6_mode_flow'; base='mx3_flow_compound'; overrides=@{
      # Same controller stack, but tuned for throughput under GREEN/YELLOW.
      MARKET_MODE_OWNS_STRICTNESS='true';
      MARKET_MODE_ENTER_STREAK='2';
      MARKET_MODE_EXIT_STREAK='3';
      MARKET_MODE_STRICT_SCORE='77';
      MARKET_MODE_SOFT_SCORE='69';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='3';
      MARKET_MODE_YELLOW_SIZE_MULT='0.86';
      MARKET_MODE_RED_SIZE_MULT='0.58';
      MARKET_MODE_YELLOW_HOLD_MULT='0.82';
      MARKET_MODE_RED_HOLD_MULT='0.62';
      MARKET_MODE_YELLOW_PARTIAL_TP_TRIGGER_MULT='0.92';
      MARKET_MODE_RED_PARTIAL_TP_TRIGGER_MULT='0.78';
      MARKET_MODE_YELLOW_PARTIAL_TP_SELL_MULT='1.15';
      MARKET_MODE_RED_PARTIAL_TP_SELL_MULT='1.35';
      MIN_TOKEN_SCORE='49';
      SAFE_MIN_VOLUME_5M_USD='40';
      AUTO_TRADE_TOP_N='17';
      MAX_BUYS_PER_HOUR='64';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.52';
      PAPER_TRADE_SIZE_MAX_USD='0.96';
      HOLD_MIN_SECONDS='32';
      HOLD_MAX_SECONDS='185';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.45';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.33';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.0';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='8.4';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='70';
      AUTONOMOUS_CONTROL_TOP_N_MAX='20';
      AUTONOMOUS_CONTROL_MAX_OPEN_TRADES_MAX='5';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.7';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='13.0';
      ADAPTIVE_SAFE_VOLUME_MIN='30';
      ADAPTIVE_SAFE_VOLUME_MAX='170';
      ADAPTIVE_EDGE_MIN='0.58';
      ADAPTIVE_DEDUP_TTL_MIN='7';
      ADAPTIVE_DEDUP_TTL_MAX='35';
      PAPER_RESET_ON_START='false';
    }
  },
  @{ name='mx7_recover_balanced'; base='mx3_flow_compound'; overrides=@{
      # Recovery profile: unlock flow, keep guardrails, disable shard split for parity.
      CANDIDATE_SHARD_MOD='1';
      CANDIDATE_SHARD_SLOT='0';
      PAPER_RESET_ON_START='true';
      MARKET_MODE_OWNS_STRICTNESS='true';
      MARKET_MODE_ENTER_STREAK='2';
      MARKET_MODE_EXIT_STREAK='3';
      MARKET_MODE_STRICT_SCORE='73';
      MARKET_MODE_SOFT_SCORE='66';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='4';
      MIN_TOKEN_SCORE='47';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='6';
      SAFE_MIN_VOLUME_5M_USD='38';
      AUTO_TRADE_TOP_N='16';
      MAX_BUYS_PER_HOUR='72';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.48';
      PAPER_TRADE_SIZE_MAX_USD='0.90';
      HOLD_MIN_SECONDS='30';
      HOLD_MAX_SECONDS='170';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.3';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='14.0';
      ADAPTIVE_SAFE_VOLUME_MIN='28';
      ADAPTIVE_SAFE_VOLUME_MAX='180';
      ADAPTIVE_DEDUP_TTL_MIN='6';
      ADAPTIVE_DEDUP_TTL_MAX='30';
    }
  },
  @{ name='mx8_recover_flow'; base='mx3_flow_compound'; overrides=@{
      # Recovery flow profile: more throughput, still market-mode controlled.
      CANDIDATE_SHARD_MOD='1';
      CANDIDATE_SHARD_SLOT='0';
      PAPER_RESET_ON_START='true';
      MARKET_MODE_OWNS_STRICTNESS='true';
      MARKET_MODE_ENTER_STREAK='2';
      MARKET_MODE_EXIT_STREAK='3';
      MARKET_MODE_STRICT_SCORE='74';
      MARKET_MODE_SOFT_SCORE='65';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='5';
      MIN_TOKEN_SCORE='46';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='5';
      SAFE_MIN_VOLUME_5M_USD='34';
      AUTO_TRADE_TOP_N='20';
      MAX_BUYS_PER_HOUR='84';
      MAX_OPEN_TRADES='5';
      PAPER_TRADE_SIZE_MIN_USD='0.45';
      PAPER_TRADE_SIZE_MAX_USD='0.88';
      HOLD_MIN_SECONDS='26';
      HOLD_MAX_SECONDS='155';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.6';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='16.0';
      ADAPTIVE_SAFE_VOLUME_MIN='24';
      ADAPTIVE_SAFE_VOLUME_MAX='190';
      ADAPTIVE_DEDUP_TTL_MIN='5';
      ADAPTIVE_DEDUP_TTL_MAX='24';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.4';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='9.5';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='86';
      AUTONOMOUS_CONTROL_TOP_N_MAX='22';
    }
  },
  @{ name='mx9_exit_tight'; base='mx7_recover_balanced'; overrides=@{
      # Exit-focused profile: cut weak/flat trades faster, keep entry quality.
      CANDIDATE_SHARD_MOD='1';
      CANDIDATE_SHARD_SLOT='0';
      PAPER_RESET_ON_START='true';
      MARKET_MODE_EXIT_STREAK='2';
      MARKET_REGIME_FAIL_CLOSED_RATIO='45';
      MARKET_REGIME_SOURCE_ERROR_PERCENT='38';
      MARKET_MODE_STRICT_SCORE='72';
      MARKET_MODE_SOFT_SCORE='65';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='5';
      NO_MOMENTUM_EXIT_ENABLED='true';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='8';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='35';
      NO_MOMENTUM_EXIT_MAX_PEAK_PERCENT='0.85';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.20';
      WEAKNESS_EXIT_ENABLED='true';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='10';
      WEAKNESS_EXIT_PNL_PERCENT='-2.2';
      PAPER_MAX_HOLD_SECONDS='130';
      HOLD_MIN_SECONDS='24';
      HOLD_MAX_SECONDS='125';
      STOP_LOSS_PERCENT='3';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.10';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.42';
      PAPER_PARTIAL_TP_BREAK_EVEN_BUFFER_PERCENT='0.08';
      SAFE_MIN_VOLUME_5M_USD='42';
      AUTO_TRADE_TOP_N='14';
      MAX_OPEN_TRADES='3';
      MAX_BUYS_PER_HOUR='56';
      PAPER_TRADE_SIZE_MIN_USD='0.46';
      PAPER_TRADE_SIZE_MAX_USD='0.82';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.1';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='12.0';
      ADAPTIVE_DEDUP_TTL_MIN='5';
      ADAPTIVE_DEDUP_TTL_MAX='22';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='5';
    }
  },
  @{ name='mx10_exit_adaptive'; base='mx8_recover_flow'; overrides=@{
      # Adaptive exit profile: keep throughput, but force earlier cleanup and faster TP capture.
      CANDIDATE_SHARD_MOD='1';
      CANDIDATE_SHARD_SLOT='0';
      PAPER_RESET_ON_START='true';
      MARKET_MODE_EXIT_STREAK='2';
      MARKET_REGIME_FAIL_CLOSED_RATIO='46';
      MARKET_REGIME_SOURCE_ERROR_PERCENT='40';
      MARKET_MODE_STRICT_SCORE='73';
      MARKET_MODE_SOFT_SCORE='64';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='6';
      NO_MOMENTUM_EXIT_ENABLED='true';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='7';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='30';
      NO_MOMENTUM_EXIT_MAX_PEAK_PERCENT='0.90';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.15';
      WEAKNESS_EXIT_ENABLED='true';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='9';
      WEAKNESS_EXIT_PNL_PERCENT='-2.0';
      PAPER_MAX_HOLD_SECONDS='120';
      HOLD_MIN_SECONDS='22';
      HOLD_MAX_SECONDS='118';
      STOP_LOSS_PERCENT='3';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.00';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.46';
      PAPER_PARTIAL_TP_BREAK_EVEN_BUFFER_PERCENT='0.08';
      SAFE_MIN_VOLUME_5M_USD='36';
      AUTO_TRADE_TOP_N='18';
      MAX_OPEN_TRADES='4';
      MAX_BUYS_PER_HOUR='68';
      PAPER_TRADE_SIZE_MIN_USD='0.44';
      PAPER_TRADE_SIZE_MAX_USD='0.80';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.3';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='13.0';
      ADAPTIVE_DEDUP_TTL_MIN='4';
      ADAPTIVE_DEDUP_TTL_MAX='20';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='4';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.2';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='8.8';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='72';
      AUTONOMOUS_CONTROL_TOP_N_MAX='20';
    }
  },
  @{ name='mx11_baseline_adapted'; base='mx3_flow_compound'; overrides=@{
      # Last-known strong baseline, adapted to new market-mode controllers.
      CANDIDATE_SHARD_MOD='1';
      CANDIDATE_SHARD_SLOT='0';
      PAPER_RESET_ON_START='true';
      STRATEGY_ORCHESTRATOR_ENABLED='true';
      STRATEGY_ORCHESTRATOR_MODE='apply';
      STRATEGY_ORCHESTRATOR_LOCK_AUTONOMY_CONTROLS='true';
      STRATEGY_ORCHESTRATOR_INTERVAL_SECONDS='300';
      STRATEGY_ORCHESTRATOR_MIN_WINDOW_CYCLES='2';
      STRATEGY_ORCHESTRATOR_MIN_CLOSED_DELTA='6';
      STRATEGY_ORCHESTRATOR_DEFENSE_ENTER_STREAK='2';
      STRATEGY_ORCHESTRATOR_HARVEST_ENTER_STREAK='2';
      STRATEGY_ORCHESTRATOR_DEFENSE_TRIGGER_AVG_PNL_PER_TRADE_USD='-0.0020';
      STRATEGY_ORCHESTRATOR_DEFENSE_TRIGGER_LOSS_SHARE='0.62';
      STRATEGY_ORCHESTRATOR_HARVEST_TRIGGER_AVG_PNL_PER_TRADE_USD='0.0010';
      STRATEGY_ORCHESTRATOR_HARVEST_TRIGGER_LOSS_SHARE='0.45';
      STRATEGY_ORCHESTRATOR_INITIAL_PROFILE='harvest';
      STRATEGY_ORCHESTRATOR_HARVEST_MAX_OPEN_TRADES='4';
      STRATEGY_ORCHESTRATOR_HARVEST_TOP_N='15';
      STRATEGY_ORCHESTRATOR_HARVEST_MAX_BUYS_PER_HOUR='60';
      STRATEGY_ORCHESTRATOR_HARVEST_TRADE_SIZE_MAX_USD='0.86';
      STRATEGY_ORCHESTRATOR_HARVEST_HOLD_MAX_SECONDS='145';
      STRATEGY_ORCHESTRATOR_HARVEST_NO_MOMENTUM_MIN_AGE_PERCENT='12';
      STRATEGY_ORCHESTRATOR_HARVEST_NO_MOMENTUM_MAX_PNL_PERCENT='0.25';
      STRATEGY_ORCHESTRATOR_HARVEST_WEAKNESS_MIN_AGE_PERCENT='14';
      STRATEGY_ORCHESTRATOR_HARVEST_WEAKNESS_PNL_PERCENT='-2.6';
      STRATEGY_ORCHESTRATOR_HARVEST_PARTIAL_TP_TRIGGER_PERCENT='1.20';
      STRATEGY_ORCHESTRATOR_HARVEST_PARTIAL_TP_SELL_FRACTION='0.40';
      STRATEGY_ORCHESTRATOR_DEFENSE_MAX_OPEN_TRADES='3';
      STRATEGY_ORCHESTRATOR_DEFENSE_TOP_N='11';
      STRATEGY_ORCHESTRATOR_DEFENSE_MAX_BUYS_PER_HOUR='42';
      STRATEGY_ORCHESTRATOR_DEFENSE_TRADE_SIZE_MAX_USD='0.72';
      STRATEGY_ORCHESTRATOR_DEFENSE_HOLD_MAX_SECONDS='118';
      STRATEGY_ORCHESTRATOR_DEFENSE_NO_MOMENTUM_MIN_AGE_PERCENT='9';
      STRATEGY_ORCHESTRATOR_DEFENSE_NO_MOMENTUM_MAX_PNL_PERCENT='0.15';
      STRATEGY_ORCHESTRATOR_DEFENSE_WEAKNESS_MIN_AGE_PERCENT='11';
      STRATEGY_ORCHESTRATOR_DEFENSE_WEAKNESS_PNL_PERCENT='-2.0';
      STRATEGY_ORCHESTRATOR_DEFENSE_PARTIAL_TP_TRIGGER_PERCENT='1.00';
      STRATEGY_ORCHESTRATOR_DEFENSE_PARTIAL_TP_SELL_FRACTION='0.50';
      MARKET_MODE_OWNS_STRICTNESS='true';
      MARKET_MODE_ENTER_STREAK='2';
      MARKET_MODE_EXIT_STREAK='2';
      MARKET_MODE_STRICT_SCORE='74';
      MARKET_MODE_SOFT_SCORE='66';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='4';
      MARKET_REGIME_FAIL_CLOSED_RATIO='42';
      MARKET_REGIME_SOURCE_ERROR_PERCENT='36';
      MIN_TOKEN_SCORE='48';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='6';
      NO_MOMENTUM_EXIT_ENABLED='true';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='12';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='45';
      NO_MOMENTUM_EXIT_MAX_PEAK_PERCENT='0.95';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.25';
      WEAKNESS_EXIT_ENABLED='true';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='14';
      WEAKNESS_EXIT_PNL_PERCENT='-2.6';
      PAPER_MAX_HOLD_SECONDS='150';
      HOLD_MIN_SECONDS='28';
      HOLD_MAX_SECONDS='145';
      STOP_LOSS_PERCENT='3';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.20';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.40';
      PAPER_PARTIAL_TP_BREAK_EVEN_BUFFER_PERCENT='0.08';
      AUTO_TRADE_TOP_N='15';
      MAX_BUYS_PER_HOUR='60';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.48';
      PAPER_TRADE_SIZE_MAX_USD='0.86';
      SAFE_MIN_VOLUME_5M_USD='40';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.3';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='12.5';
      ADAPTIVE_DEDUP_TTL_MIN='5';
      ADAPTIVE_DEDUP_TTL_MAX='26';
    }
  },
  @{ name='mx12_guarded_delta'; base='mx11_baseline_adapted'; overrides=@{
      # Small-step profile: minimal, measurable deltas from golden baseline.
      PAPER_RESET_ON_START='true';
      MARKET_MODE_STRICT_SCORE='73';
      MARKET_MODE_SOFT_SCORE='65';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='11';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='42';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='13';
      WEAKNESS_EXIT_PNL_PERCENT='-2.5';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.15';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.42';
      PAPER_MAX_HOLD_SECONDS='145';
      HOLD_MAX_SECONDS='140';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.2';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='12.2';
      ADAPTIVE_DEDUP_TTL_MAX='24';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='5';
      MAX_BUYS_PER_HOUR='62';
      AUTO_TRADE_TOP_N='16';
    }
  },
  @{ name='mx13_battle_full'; base='mx11_baseline_adapted'; overrides=@{
      # Battle profile: full package tuned for stronger throughput + active risk exits.
      PAPER_RESET_ON_START='true';
      MARKET_MODE_EXIT_STREAK='1';
      MARKET_MODE_STRICT_SCORE='72';
      MARKET_MODE_SOFT_SCORE='64';
      MARKET_MODE_YELLOW_SOFT_CAP_PER_CYCLE='6';
      MARKET_REGIME_FAIL_CLOSED_RATIO='44';
      MARKET_REGIME_SOURCE_ERROR_PERCENT='38';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='9';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='32';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.18';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='11';
      WEAKNESS_EXIT_PNL_PERCENT='-2.1';
      PAPER_MAX_HOLD_SECONDS='125';
      HOLD_MIN_SECONDS='24';
      HOLD_MAX_SECONDS='122';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.00';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.48';
      STOP_LOSS_PERCENT='3';
      AUTO_TRADE_TOP_N='18';
      MAX_BUYS_PER_HOUR='72';
      MAX_OPEN_TRADES='5';
      PAPER_TRADE_SIZE_MIN_USD='0.50';
      PAPER_TRADE_SIZE_MAX_USD='0.92';
      SAFE_MIN_VOLUME_5M_USD='38';
      ADAPTIVE_FILTERS_TARGET_CAND_MIN='1.4';
      ADAPTIVE_FILTERS_TARGET_CAND_MAX='13.8';
      ADAPTIVE_DEDUP_TTL_MIN='4';
      ADAPTIVE_DEDUP_TTL_MAX='20';
      HEAVY_CHECK_DEDUP_TTL_SECONDS='4';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_MIN='1.3';
      AUTONOMOUS_CONTROL_TARGET_CANDIDATES_HIGH='9.2';
      AUTONOMOUS_CONTROL_MAX_BUYS_PER_HOUR_MAX='78';
      AUTONOMOUS_CONTROL_TOP_N_MAX='22';
    }
  },
  @{ name='mx14_cooldown_guard'; base='mx11_baseline_adapted'; overrides=@{
      # Dynamic per-token cooldown escalation, minimal deltas from baseline.
      PAPER_RESET_ON_START='true';
      AUTO_TRADE_TOKEN_COOLDOWN_DYNAMIC_ENABLED='true';
      AUTO_TRADE_TOKEN_COOLDOWN_STEP_SECONDS='300';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_STRIKES='4';
      AUTO_TRADE_TOKEN_COOLDOWN_RECOVERY_STEP='1';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_SECONDS='2400';
      AUTO_TRADE_TOKEN_COOLDOWN_ESCALATE_REASONS='SL,NO_MOMENTUM,TIMEOUT,WEAKNESS,ABANDON';
      STRATEGY_ORCHESTRATOR_RED_FORCE_DEFENSE_ENABLED='true';
      STRATEGY_ORCHESTRATOR_RED_FORCE_DEFENSE_REALIZED_DELTA_USD='-0.05';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='12';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='48';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='15';
      WEAKNESS_EXIT_PNL_PERCENT='-2.7';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.15';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.43';
    }
  },
  @{ name='mx15_cooldown_combat'; base='mx11_baseline_adapted'; overrides=@{
      # Stronger cooldown escalation plus faster cleanup for repeat-losers.
      PAPER_RESET_ON_START='true';
      AUTO_TRADE_TOKEN_COOLDOWN_DYNAMIC_ENABLED='true';
      AUTO_TRADE_TOKEN_COOLDOWN_STEP_SECONDS='420';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_STRIKES='5';
      AUTO_TRADE_TOKEN_COOLDOWN_RECOVERY_STEP='1';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_SECONDS='3000';
      AUTO_TRADE_TOKEN_COOLDOWN_ESCALATE_REASONS='SL,NO_MOMENTUM,TIMEOUT,WEAKNESS,ABANDON';
      STRATEGY_ORCHESTRATOR_RED_FORCE_DEFENSE_ENABLED='true';
      STRATEGY_ORCHESTRATOR_RED_FORCE_DEFENSE_REALIZED_DELTA_USD='-0.08';
      MARKET_MODE_STRICT_SCORE='73';
      MARKET_MODE_SOFT_SCORE='65';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='10';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='38';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.20';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='12';
      WEAKNESS_EXIT_PNL_PERCENT='-2.3';
      PAPER_MAX_HOLD_SECONDS='132';
      HOLD_MAX_SECONDS='128';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.05';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.47';
      MAX_BUYS_PER_HOUR='66';
      AUTO_TRADE_TOP_N='16';
    }
  },
  @{ name='mx16_ev_floor'; base='mx14_cooldown_guard'; overrides=@{
      # EV-focused: keep throughput close, but cut micro-edge noise and let winners breathe a bit longer.
      PAPER_RESET_ON_START='true';
      MIN_EXPECTED_EDGE_USD='0.028';
      MIN_EXPECTED_EDGE_PERCENT='0.75';
      AUTO_TRADE_TOP_N='17';
      MAX_BUYS_PER_HOUR='64';
      MARKET_MODE_STRICT_SCORE='73';
      MARKET_MODE_SOFT_SCORE='65';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='14';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='60';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.18';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='16';
      WEAKNESS_EXIT_PNL_PERCENT='-2.8';
      HOLD_MAX_SECONDS='152';
      PAPER_MAX_HOLD_SECONDS='158';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.25';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.35';
      AUTO_TRADE_TOKEN_COOLDOWN_STEP_SECONDS='360';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_SECONDS='2600';
      SYMBOL_EV_GUARD_ENABLED='true';
      SYMBOL_EV_WINDOW_MINUTES='120';
      SYMBOL_EV_MIN_TRADES='3';
      SYMBOL_EV_MIN_AVG_PNL_USD='0.0005';
      SYMBOL_EV_MAX_LOSS_SHARE='0.60';
      SYMBOL_EV_BAD_TO_STRICT_ONLY='true';
      SYMBOL_EV_BAD_COOLDOWN_SECONDS='1200';
      SYMBOL_FATIGUE_MAX_TRADES_PER_WINDOW='4';
      SYMBOL_FATIGUE_MAX_LOSS_STREAK='3';
      SYMBOL_FATIGUE_COOLDOWN_SECONDS='1800';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='3600';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='20';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='0.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0005';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.58';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.18';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='2';
    }
  },
  @{ name='mx17_tp_bias'; base='mx15_cooldown_combat'; overrides=@{
      # TP-bias: stronger anti-repeat-loser cooldown, higher edge floor, preserve entry flow via wider top_n/buys.
      PAPER_RESET_ON_START='true';
      MIN_EXPECTED_EDGE_USD='0.032';
      MIN_EXPECTED_EDGE_PERCENT='0.85';
      AUTO_TRADE_TOP_N='18';
      MAX_BUYS_PER_HOUR='70';
      MARKET_MODE_STRICT_SCORE='72';
      MARKET_MODE_SOFT_SCORE='64';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='13';
      NO_MOMENTUM_EXIT_MIN_HOLD_SECONDS='55';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.22';
      WEAKNESS_EXIT_MIN_AGE_PERCENT='14';
      WEAKNESS_EXIT_PNL_PERCENT='-2.5';
      HOLD_MAX_SECONDS='148';
      PAPER_MAX_HOLD_SECONDS='154';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.30';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.30';
      AUTO_TRADE_TOKEN_COOLDOWN_STEP_SECONDS='540';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_SECONDS='3200';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_STRIKES='5';
      SYMBOL_EV_GUARD_ENABLED='true';
      SYMBOL_EV_WINDOW_MINUTES='120';
      SYMBOL_EV_MIN_TRADES='3';
      SYMBOL_EV_MIN_AVG_PNL_USD='0.0008';
      SYMBOL_EV_MAX_LOSS_SHARE='0.58';
      SYMBOL_EV_BAD_TO_STRICT_ONLY='true';
      SYMBOL_EV_BAD_COOLDOWN_SECONDS='1200';
      SYMBOL_FATIGUE_MAX_TRADES_PER_WINDOW='4';
      SYMBOL_FATIGUE_MAX_LOSS_STREAK='3';
      SYMBOL_FATIGUE_COOLDOWN_SECONDS='1800';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='3600';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='20';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='0.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0005';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.58';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.18';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='2';
    }
  },
  @{ name='mx18_v2_balanced'; base='mx16_ev_floor'; overrides=@{
      # V2 balanced: champion baseline + universe diversity + safety budget + reinvest + runtime calibration.
      PAPER_RESET_ON_START='true';
      DATA_POLICY_ENTER_STREAK='3';
      DATA_POLICY_EXIT_STREAK='3';
      MARKET_MODE_ENTER_STREAK='3';
      MARKET_MODE_EXIT_STREAK='4';
      TOKEN_SAFETY_TRANSIENT_DEGRADED_ENABLED='true';
      TOKEN_SAFETY_TRANSIENT_USE_CACHE='true';
      TOKEN_SAFETY_TRANSIENT_USE_FALLBACK='true';
      TOKEN_SAFETY_TRANSIENT_REASONS='api_code_4029,http_429,http_408,http_500,http_502,http_503,http_504';
      V2_UNIVERSE_ENABLED='true';
      V2_UNIVERSE_MAX_TOTAL_PER_CYCLE='140';
      V2_UNIVERSE_NOVELTY_WINDOW_SECONDS='2100';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.34';
      V2_UNIVERSE_NOVELTY_MIN_ABS='3';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='180';
      V2_UNIVERSE_PASS_REPEAT_OVERRIDE_VOL_MULT='2.3';
      V2_UNIVERSE_SOURCE_CAPS='onchain:120,onchain+market:120,dexscreener:100,geckoterminal:100,watchlist:30,dex_boosts:40';
      V2_UNIVERSE_SOURCE_WEIGHTS='onchain:1.15,onchain+market:1.10,dexscreener:1.00,geckoterminal:1.05,watchlist:0.90,dex_boosts:1.10';
      V2_UNIVERSE_SYMBOL_REPEAT_WINDOW_SECONDS='1800';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='4';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='8';
      V2_UNIVERSE_SYMBOL_REPEAT_PENALTY_MULT='0.72';
      V2_UNIVERSE_SYMBOL_REPEAT_OVERRIDE_VOL_MULT='2.5';
      DATA_POLICY_HARD_BLOCK_ENABLED='false';
      V2_POLICY_ROUTER_ENABLED='true';
      V2_POLICY_FAIL_CLOSED_ACTION='limited';
      V2_POLICY_DEGRADED_ACTION='limited';
      V2_POLICY_LIMITED_ENTRY_RATIO='0.38';
      V2_POLICY_LIMITED_MIN_PER_CYCLE='2';
      V2_POLICY_LIMITED_ONLY_STRICT='true';
      V2_POLICY_LIMITED_ALLOW_EXPLORE_IN_RED='false';
      V2_ENTRY_DUAL_CHANNEL_ENABLED='true';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.30';
      V2_ENTRY_EXPLORE_MAX_PER_CYCLE='3';
      V2_ENTRY_EXPLORE_ALLOW_IN_RED='false';
      V2_ENTRY_CORE_MIN_PER_CYCLE='1';
      V2_ENTRY_EXPLORE_SIZE_MULT='0.48';
      V2_ENTRY_EXPLORE_HOLD_MULT='0.78';
      V2_EXPLORE_EDGE_USD_MULT='0.78';
      V2_EXPLORE_EDGE_PERCENT_MULT='0.84';
      V2_SAFETY_BUDGET_ENABLED='true';
      V2_SAFETY_BUDGET_MAX_PER_CYCLE='95';
      V2_SAFETY_BUDGET_PER_SOURCE='onchain:52,onchain+market:52,dexscreener:46,geckoterminal:46,watchlist:18,dex_boosts:20';
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='900';
      V2_CALIBRATION_MIN_CLOSED='120';
      V2_CALIBRATION_LOOKBACK_ROWS='2200';
      V2_CALIBRATION_SMOOTH_ALPHA='0.35';
      V2_CALIBRATION_EDGE_USD_MIN='0.012';
      V2_CALIBRATION_EDGE_USD_MAX='0.080';
      V2_CALIBRATION_VOLUME_MIN='28';
      V2_CALIBRATION_VOLUME_MAX='180';
      V2_REINVEST_ENABLED='true';
      V2_REINVEST_MIN_MULT='0.82';
      V2_REINVEST_MAX_MULT='1.42';
      V2_REINVEST_GROWTH_STEP_USD='0.55';
      V2_REINVEST_STEP_MULT='0.05';
      V2_REINVEST_DRAWDOWN_CUT_PERCENT='2.6';
      V2_REINVEST_DRAWDOWN_MULT='0.82';
      V2_REINVEST_LOSS_STREAK_STEP='0.08';
      V2_REINVEST_HIGH_EDGE_THRESHOLD_PERCENT='1.30';
      V2_REINVEST_HIGH_EDGE_BONUS='0.05';
      V2_CHAMPION_GUARD_ENABLED='true';
      V2_CHAMPION_GUARD_INTERVAL_SECONDS='120';
      V2_CHAMPION_GUARD_MIN_RUNTIME_SECONDS='4200';
      V2_CHAMPION_GUARD_MIN_CLOSED_TRADES='22';
      V2_CHAMPION_GUARD_MAX_LAG_USD='0.28';
      V2_CHAMPION_GUARD_FAIL_WINDOWS='3';
      V2_ROLLING_EDGE_ENABLED='true';
      V2_ROLLING_EDGE_INTERVAL_SECONDS='240';
      V2_ROLLING_EDGE_MIN_CLOSED='24';
      V2_ROLLING_EDGE_WINDOW_CLOSED='120';
      V2_ROLLING_EDGE_RELAX_STEP_USD='0.0018';
      V2_ROLLING_EDGE_TIGHTEN_STEP_USD='0.0023';
      V2_ROLLING_EDGE_RELAX_STEP_PERCENT='0.07';
      V2_ROLLING_EDGE_TIGHTEN_STEP_PERCENT='0.10';
      V2_ROLLING_EDGE_MIN_USD='0.008';
      V2_ROLLING_EDGE_MAX_USD='0.080';
      V2_ROLLING_EDGE_MIN_PERCENT='0.35';
      V2_ROLLING_EDGE_MAX_PERCENT='1.80';
      V2_ROLLING_EDGE_EDGE_LOW_SHARE_RELAX='0.64';
      V2_ROLLING_EDGE_LOSS_SHARE_TIGHTEN='0.58';
      V2_KPI_LOOP_ENABLED='true';
      V2_KPI_LOOP_INTERVAL_SECONDS='300';
      V2_KPI_LOOP_WINDOW_CYCLES='20';
      V2_KPI_EDGE_LOW_RELAX_TRIGGER='0.70';
      V2_KPI_OPEN_RATE_LOW_TRIGGER='0.03';
      V2_KPI_POLICY_BLOCK_TRIGGER='0.35';
      V2_KPI_UNIQUE_SYMBOLS_MIN='7';
      V2_KPI_MAX_BUYS_BOOST_STEP='4';
      V2_KPI_MAX_BUYS_CAP='90';
      V2_KPI_TOPN_BOOST_STEP='1';
      V2_KPI_TOPN_CAP='22';
      V2_KPI_EXPLORE_SHARE_STEP='0.03';
      V2_KPI_EXPLORE_SHARE_MAX='0.50';
      V2_KPI_NOVELTY_SHARE_STEP='0.03';
      V2_KPI_NOVELTY_SHARE_MAX='0.55';
      SYMBOL_EV_BAD_ACTION='degrade';
      EV_FIRST_ENTRY_ENABLED='true';
      EV_FIRST_ENTRY_MIN_SAMPLES='22';
      EV_FIRST_ENTRY_MIN_NET_USD='0.0010';
      EV_FIRST_ENTRY_MIN_NET_USD_GREEN_MULT='1.00';
      EV_FIRST_ENTRY_MIN_NET_USD_YELLOW_MULT='1.08';
      EV_FIRST_ENTRY_MIN_NET_USD_RED_MULT='1.20';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.25';
      KELLY_LITE_ENABLED='true';
      KELLY_LITE_MIN_MULT='0.62';
      KELLY_LITE_MAX_MULT='1.48';
      KELLY_LITE_MAX_FRACTION='0.42';
      TOKEN_EV_MEMORY_ENABLED='true';
      TOKEN_EV_MEMORY_MIN_TRADES='4';
      TOKEN_EV_MEMORY_BAD_AVG_PNL_USD='0.0001';
      TOKEN_EV_MEMORY_BAD_LOSS_SHARE='0.62';
      TOKEN_EV_MEMORY_SEVERE_AVG_PNL_USD='-0.0016';
      TOKEN_EV_MEMORY_SEVERE_LOSS_SHARE='0.74';
      TOKEN_EV_MEMORY_BAD_SIZE_MULT='0.80';
      TOKEN_EV_MEMORY_SEVERE_SIZE_MULT='0.60';
      TOKEN_EV_MEMORY_BAD_EDGE_MULT='1.10';
      TOKEN_EV_MEMORY_SEVERE_EDGE_MULT='1.26';
      TOKEN_EV_MEMORY_BAD_ENTRY_PROBABILITY='0.74';
      TOKEN_EV_MEMORY_SEVERE_ENTRY_PROBABILITY='0.45';
      ASYMMETRIC_EXITS_ENABLED='true';
      ASYM_PRE_PARTIAL_RISK_ENABLED='true';
      ASYM_PRE_PARTIAL_MIN_AGE_SECONDS='24';
      ASYM_PRE_PARTIAL_MAX_PEAK_PERCENT='0.90';
      ASYM_PRE_PARTIAL_MAX_LOSS_PERCENT='-1.30';
      ASYM_POST_PARTIAL_PROTECT_ENABLED='true';
      ASYM_POST_PARTIAL_MIN_PEAK_PERCENT='0.85';
      ASYM_POST_PARTIAL_PROTECT_MIN_FLOOR_PERCENT='0.14';
      ASYM_POST_PARTIAL_PROTECT_GIVEBACK_PERCENT='0.52';
      V2_REGIME_REANCHOR_ENABLED='true';
      V2_REGIME_REANCHOR_EDGE_REFERENCE_PERCENT='0.90';
      V2_REGIME_REANCHOR_EDGE_REFERENCE_USD='0.0133';
      V2_REGIME_REANCHOR_SENSITIVITY='0.88';
      V2_REGIME_REANCHOR_MAX_RELAX='0.45';
      MIN_EXPECTED_EDGE_USD='0.0133';
      MIN_EXPECTED_EDGE_PERCENT='0.90';
      SAFE_MIN_VOLUME_5M_USD='44';
      PAPER_PARTIAL_TP_STAGE2_ENABLED='true';
      PAPER_PARTIAL_TP_STAGE2_TRIGGER_MULT='2.00';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.32';
      PAPER_PARTIAL_TP_MIN_REMAINING_USD='0.12';
      PAPER_PARTIAL_TP_BREAK_EVEN_STAGE2_BONUS_PERCENT='0.12';
      PAPER_PARTIAL_TP_BE_PROTECT_ENABLED='true';
      PAPER_PARTIAL_TP_BE_PROTECT_FLOOR_PERCENT='0.05';
      PAPER_PARTIAL_TP_BE_PROTECT_STAGE2_BONUS_PERCENT='0.10';
      PAPER_TRAILING_EXIT_ENABLED='true';
      PAPER_TRAILING_ACTIVATE_PEAK_PERCENT='1.40';
      PAPER_TRAILING_GIVEBACK_PERCENT='1.05';
      PAPER_TRAILING_GIVEBACK_RATIO='0.56';
      PAPER_TRAILING_MIN_PNL_PERCENT='0.22';
      MOMENTUM_DECAY_EXIT_ENABLED='true';
      MOMENTUM_DECAY_MIN_AGE_PERCENT='18';
      MOMENTUM_DECAY_MIN_HOLD_SECONDS='60';
      MOMENTUM_DECAY_MIN_PEAK_PERCENT='2.20';
      MOMENTUM_DECAY_RETAIN_RATIO='0.38';
      MOMENTUM_DECAY_MIN_DROP_PERCENT='1.10';
      MOMENTUM_DECAY_MAX_PNL_PERCENT='0.75';
      EXIT_TIMEOUT_EXTENSION_ENABLED='true';
      EXIT_TIMEOUT_EXTENSION_MAX_SECONDS='65';
      EXIT_TIMEOUT_EXTENSION_EDGE_SECONDS='18';
      EXIT_TIMEOUT_EXTENSION_MIN_EDGE_PERCENT='1.35';
      EXIT_TIMEOUT_EXTENSION_MOMENTUM_SECONDS='24';
      EXIT_TIMEOUT_EXTENSION_MIN_PEAK_PERCENT='1.60';
      EXIT_TIMEOUT_EXTENSION_MIN_PNL_PERCENT='0.24';
      EXIT_TIMEOUT_EXTENSION_POST_PARTIAL_SECONDS='14';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.16';
      WEAKNESS_EXIT_PNL_PERCENT='-2.90';
      HOLD_MAX_SECONDS='175';
      PAPER_MAX_HOLD_SECONDS='180';
      MAX_BUYS_PER_HOUR='62';
      AUTO_TRADE_TOP_N='17';
      MAX_OPEN_TRADES='4';
      PAPER_TRADE_SIZE_MIN_USD='0.50';
      PAPER_TRADE_SIZE_MAX_USD='0.88';
    }
  },
  @{ name='mx19_v2_aggressive'; base='mx16_ev_floor'; overrides=@{
      # V2 aggressive: higher flow, same protections, stronger reinvest ceiling, faster calibration.
      PAPER_RESET_ON_START='true';
      DATA_POLICY_ENTER_STREAK='3';
      DATA_POLICY_EXIT_STREAK='3';
      MARKET_MODE_ENTER_STREAK='3';
      MARKET_MODE_EXIT_STREAK='4';
      TOKEN_SAFETY_TRANSIENT_DEGRADED_ENABLED='true';
      TOKEN_SAFETY_TRANSIENT_USE_CACHE='true';
      TOKEN_SAFETY_TRANSIENT_USE_FALLBACK='true';
      TOKEN_SAFETY_TRANSIENT_REASONS='api_code_4029,http_429,http_408,http_500,http_502,http_503,http_504';
      V2_UNIVERSE_ENABLED='true';
      V2_UNIVERSE_MAX_TOTAL_PER_CYCLE='180';
      V2_UNIVERSE_NOVELTY_WINDOW_SECONDS='1500';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.28';
      V2_UNIVERSE_NOVELTY_MIN_ABS='2';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='140';
      V2_UNIVERSE_PASS_REPEAT_OVERRIDE_VOL_MULT='2.0';
      V2_UNIVERSE_SOURCE_CAPS='onchain:145,onchain+market:145,dexscreener:120,geckoterminal:120,watchlist:34,dex_boosts:55';
      V2_UNIVERSE_SOURCE_WEIGHTS='onchain:1.12,onchain+market:1.08,dexscreener:1.00,geckoterminal:1.05,watchlist:0.95,dex_boosts:1.15';
      V2_UNIVERSE_SYMBOL_REPEAT_WINDOW_SECONDS='1500';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='5';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='10';
      V2_UNIVERSE_SYMBOL_REPEAT_PENALTY_MULT='0.78';
      V2_UNIVERSE_SYMBOL_REPEAT_OVERRIDE_VOL_MULT='2.2';
      DATA_POLICY_HARD_BLOCK_ENABLED='false';
      V2_POLICY_ROUTER_ENABLED='true';
      V2_POLICY_FAIL_CLOSED_ACTION='limited';
      V2_POLICY_DEGRADED_ACTION='limited';
      V2_POLICY_LIMITED_ENTRY_RATIO='0.46';
      V2_POLICY_LIMITED_MIN_PER_CYCLE='2';
      V2_POLICY_LIMITED_ONLY_STRICT='false';
      V2_POLICY_LIMITED_ALLOW_EXPLORE_IN_RED='false';
      V2_ENTRY_DUAL_CHANNEL_ENABLED='true';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.38';
      V2_ENTRY_EXPLORE_MAX_PER_CYCLE='4';
      V2_ENTRY_EXPLORE_ALLOW_IN_RED='false';
      V2_ENTRY_CORE_MIN_PER_CYCLE='1';
      V2_ENTRY_EXPLORE_SIZE_MULT='0.55';
      V2_ENTRY_EXPLORE_HOLD_MULT='0.82';
      V2_EXPLORE_EDGE_USD_MULT='0.72';
      V2_EXPLORE_EDGE_PERCENT_MULT='0.80';
      V2_SAFETY_BUDGET_ENABLED='true';
      V2_SAFETY_BUDGET_MAX_PER_CYCLE='122';
      V2_SAFETY_BUDGET_PER_SOURCE='onchain:64,onchain+market:64,dexscreener:54,geckoterminal:54,watchlist:22,dex_boosts:28';
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='600';
      V2_CALIBRATION_MIN_CLOSED='110';
      V2_CALIBRATION_LOOKBACK_ROWS='2600';
      V2_CALIBRATION_SMOOTH_ALPHA='0.42';
      V2_CALIBRATION_EDGE_USD_MIN='0.011';
      V2_CALIBRATION_EDGE_USD_MAX='0.075';
      V2_CALIBRATION_VOLUME_MIN='24';
      V2_CALIBRATION_VOLUME_MAX='165';
      V2_REINVEST_ENABLED='true';
      V2_REINVEST_MIN_MULT='0.80';
      V2_REINVEST_MAX_MULT='1.55';
      V2_REINVEST_GROWTH_STEP_USD='0.45';
      V2_REINVEST_STEP_MULT='0.06';
      V2_REINVEST_DRAWDOWN_CUT_PERCENT='2.9';
      V2_REINVEST_DRAWDOWN_MULT='0.78';
      V2_REINVEST_LOSS_STREAK_STEP='0.09';
      V2_REINVEST_HIGH_EDGE_THRESHOLD_PERCENT='1.20';
      V2_REINVEST_HIGH_EDGE_BONUS='0.06';
      V2_CHAMPION_GUARD_ENABLED='true';
      V2_CHAMPION_GUARD_INTERVAL_SECONDS='120';
      V2_CHAMPION_GUARD_MIN_RUNTIME_SECONDS='4200';
      V2_CHAMPION_GUARD_MIN_CLOSED_TRADES='24';
      V2_CHAMPION_GUARD_MAX_LAG_USD='0.30';
      V2_CHAMPION_GUARD_FAIL_WINDOWS='3';
      V2_ROLLING_EDGE_ENABLED='true';
      V2_ROLLING_EDGE_INTERVAL_SECONDS='210';
      V2_ROLLING_EDGE_MIN_CLOSED='24';
      V2_ROLLING_EDGE_WINDOW_CLOSED='130';
      V2_ROLLING_EDGE_RELAX_STEP_USD='0.0020';
      V2_ROLLING_EDGE_TIGHTEN_STEP_USD='0.0026';
      V2_ROLLING_EDGE_RELAX_STEP_PERCENT='0.08';
      V2_ROLLING_EDGE_TIGHTEN_STEP_PERCENT='0.11';
      V2_ROLLING_EDGE_MIN_USD='0.007';
      V2_ROLLING_EDGE_MAX_USD='0.075';
      V2_ROLLING_EDGE_MIN_PERCENT='0.32';
      V2_ROLLING_EDGE_MAX_PERCENT='1.70';
      V2_ROLLING_EDGE_EDGE_LOW_SHARE_RELAX='0.66';
      V2_ROLLING_EDGE_LOSS_SHARE_TIGHTEN='0.60';
      V2_KPI_LOOP_ENABLED='true';
      V2_KPI_LOOP_INTERVAL_SECONDS='270';
      V2_KPI_LOOP_WINDOW_CYCLES='18';
      V2_KPI_EDGE_LOW_RELAX_TRIGGER='0.68';
      V2_KPI_OPEN_RATE_LOW_TRIGGER='0.03';
      V2_KPI_POLICY_BLOCK_TRIGGER='0.32';
      V2_KPI_UNIQUE_SYMBOLS_MIN='7';
      V2_KPI_MAX_BUYS_BOOST_STEP='5';
      V2_KPI_MAX_BUYS_CAP='104';
      V2_KPI_TOPN_BOOST_STEP='2';
      V2_KPI_TOPN_CAP='26';
      V2_KPI_EXPLORE_SHARE_STEP='0.04';
      V2_KPI_EXPLORE_SHARE_MAX='0.55';
      V2_KPI_NOVELTY_SHARE_STEP='0.04';
      V2_KPI_NOVELTY_SHARE_MAX='0.60';
      SYMBOL_EV_BAD_ACTION='degrade';
      EV_FIRST_ENTRY_ENABLED='true';
      EV_FIRST_ENTRY_MIN_SAMPLES='18';
      EV_FIRST_ENTRY_MIN_NET_USD='0.0008';
      EV_FIRST_ENTRY_MIN_NET_USD_GREEN_MULT='0.96';
      EV_FIRST_ENTRY_MIN_NET_USD_YELLOW_MULT='1.04';
      EV_FIRST_ENTRY_MIN_NET_USD_RED_MULT='1.16';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.18';
      KELLY_LITE_ENABLED='true';
      KELLY_LITE_MIN_MULT='0.58';
      KELLY_LITE_MAX_MULT='1.60';
      KELLY_LITE_MAX_FRACTION='0.48';
      TOKEN_EV_MEMORY_ENABLED='true';
      TOKEN_EV_MEMORY_MIN_TRADES='3';
      TOKEN_EV_MEMORY_BAD_AVG_PNL_USD='0.0000';
      TOKEN_EV_MEMORY_BAD_LOSS_SHARE='0.64';
      TOKEN_EV_MEMORY_SEVERE_AVG_PNL_USD='-0.0018';
      TOKEN_EV_MEMORY_SEVERE_LOSS_SHARE='0.75';
      TOKEN_EV_MEMORY_BAD_SIZE_MULT='0.82';
      TOKEN_EV_MEMORY_SEVERE_SIZE_MULT='0.62';
      TOKEN_EV_MEMORY_BAD_EDGE_MULT='1.08';
      TOKEN_EV_MEMORY_SEVERE_EDGE_MULT='1.22';
      TOKEN_EV_MEMORY_BAD_ENTRY_PROBABILITY='0.78';
      TOKEN_EV_MEMORY_SEVERE_ENTRY_PROBABILITY='0.50';
      ASYMMETRIC_EXITS_ENABLED='true';
      ASYM_PRE_PARTIAL_RISK_ENABLED='true';
      ASYM_PRE_PARTIAL_MIN_AGE_SECONDS='20';
      ASYM_PRE_PARTIAL_MAX_PEAK_PERCENT='0.85';
      ASYM_PRE_PARTIAL_MAX_LOSS_PERCENT='-1.25';
      ASYM_POST_PARTIAL_PROTECT_ENABLED='true';
      ASYM_POST_PARTIAL_MIN_PEAK_PERCENT='0.75';
      ASYM_POST_PARTIAL_PROTECT_MIN_FLOOR_PERCENT='0.10';
      ASYM_POST_PARTIAL_PROTECT_GIVEBACK_PERCENT='0.56';
      V2_REGIME_REANCHOR_ENABLED='true';
      V2_REGIME_REANCHOR_EDGE_REFERENCE_PERCENT='0.84';
      V2_REGIME_REANCHOR_EDGE_REFERENCE_USD='0.0118';
      V2_REGIME_REANCHOR_SENSITIVITY='0.85';
      V2_REGIME_REANCHOR_MAX_RELAX='0.42';
      MIN_EXPECTED_EDGE_USD='0.0118';
      MIN_EXPECTED_EDGE_PERCENT='0.84';
      SAFE_MIN_VOLUME_5M_USD='40';
      PAPER_PARTIAL_TP_STAGE2_ENABLED='true';
      PAPER_PARTIAL_TP_STAGE2_TRIGGER_MULT='1.75';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.38';
      PAPER_PARTIAL_TP_MIN_REMAINING_USD='0.10';
      PAPER_PARTIAL_TP_BREAK_EVEN_STAGE2_BONUS_PERCENT='0.10';
      PAPER_PARTIAL_TP_BE_PROTECT_ENABLED='true';
      PAPER_PARTIAL_TP_BE_PROTECT_FLOOR_PERCENT='0.03';
      PAPER_PARTIAL_TP_BE_PROTECT_STAGE2_BONUS_PERCENT='0.08';
      PAPER_TRAILING_EXIT_ENABLED='true';
      PAPER_TRAILING_ACTIVATE_PEAK_PERCENT='1.20';
      PAPER_TRAILING_GIVEBACK_PERCENT='0.95';
      PAPER_TRAILING_GIVEBACK_RATIO='0.60';
      PAPER_TRAILING_MIN_PNL_PERCENT='0.12';
      MOMENTUM_DECAY_EXIT_ENABLED='true';
      MOMENTUM_DECAY_MIN_AGE_PERCENT='15';
      MOMENTUM_DECAY_MIN_HOLD_SECONDS='45';
      MOMENTUM_DECAY_MIN_PEAK_PERCENT='1.80';
      MOMENTUM_DECAY_RETAIN_RATIO='0.34';
      MOMENTUM_DECAY_MIN_DROP_PERCENT='0.95';
      MOMENTUM_DECAY_MAX_PNL_PERCENT='0.65';
      EXIT_TIMEOUT_EXTENSION_ENABLED='true';
      EXIT_TIMEOUT_EXTENSION_MAX_SECONDS='48';
      EXIT_TIMEOUT_EXTENSION_EDGE_SECONDS='16';
      EXIT_TIMEOUT_EXTENSION_MIN_EDGE_PERCENT='1.20';
      EXIT_TIMEOUT_EXTENSION_MOMENTUM_SECONDS='20';
      EXIT_TIMEOUT_EXTENSION_MIN_PEAK_PERCENT='1.35';
      EXIT_TIMEOUT_EXTENSION_MIN_PNL_PERCENT='0.18';
      EXIT_TIMEOUT_EXTENSION_POST_PARTIAL_SECONDS='10';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.20';
      WEAKNESS_EXIT_PNL_PERCENT='-2.70';
      HOLD_MAX_SECONDS='165';
      PAPER_MAX_HOLD_SECONDS='170';
      MAX_BUYS_PER_HOUR='74';
      AUTO_TRADE_TOP_N='20';
      MAX_OPEN_TRADES='5';
      PAPER_TRADE_SIZE_MIN_USD='0.48';
      PAPER_TRADE_SIZE_MAX_USD='0.92';
    }
  },
  @{ name='mx20_quality_balanced'; base='mx18_v2_balanced'; overrides=@{
      # Quality-gate balanced: prioritize stable EV+ core, keep explore narrow.
      V2_QUALITY_GATE_ENABLED='true';
      V2_QUALITY_REFRESH_SECONDS='1800';
      V2_QUALITY_WINDOW_SECONDS='14400';
      V2_QUALITY_MIN_SYMBOL_TRADES='12';
      V2_QUALITY_MIN_CLUSTER_TRADES='16';
      V2_QUALITY_MIN_AVG_PNL_USD='0.0000';
      V2_QUALITY_MAX_LOSS_SHARE='0.60';
      V2_QUALITY_BAD_AVG_PNL_USD='-0.0008';
      V2_QUALITY_BAD_LOSS_SHARE='0.67';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.16';
      V2_QUALITY_EXPLORE_MIN_ABS='1';
      V2_QUALITY_COOLDOWN_PROBE_PROBABILITY='0.12';
      V2_QUALITY_COOLDOWN_SIZE_MULT='0.52';
      V2_QUALITY_COOLDOWN_HOLD_MULT='0.72';
      V2_QUALITY_COOLDOWN_EDGE_USD_MULT='1.35';
      V2_QUALITY_COOLDOWN_EDGE_PERCENT_MULT='1.30';
      V2_QUALITY_SYMBOL_CONCENTRATION_WINDOW_SECONDS='3600';
      V2_QUALITY_SYMBOL_MAX_SHARE='0.10';
      V2_QUALITY_SYMBOL_MIN_ABS_CAP='2';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='true';
      V2_QUALITY_SOURCE_MIN_TRADES='10';
      V2_QUALITY_SOURCE_WINDOW_SECONDS='14400';
      V2_QUALITY_SOURCE_GOOD_AVG_PNL_USD='0.0025';
      V2_QUALITY_SOURCE_BAD_AVG_PNL_USD='-0.0015';
      V2_QUALITY_SOURCE_BOOST_MULT='1.30';
      V2_QUALITY_SOURCE_CUT_MULT='0.62';
      V2_QUALITY_SOURCE_MIN_SHARE='0.08';
      V2_QUALITY_LOG_TOP_SYMBOLS='8';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.22';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.30';
      PROFILE_AUTOSTOP_ENABLED='false';
      SYMBOL_EV_GUARD_ENABLED='true';
      SYMBOL_EV_MIN_TRADES='6';
      SYMBOL_EV_MIN_AVG_PNL_USD='-0.0008';
      SYMBOL_EV_MAX_LOSS_SHARE='0.74';
      SYMBOL_EV_BAD_TO_STRICT_ONLY='false';
      SYMBOL_EV_BAD_ACTION='degrade';
      SYMBOL_EV_BAD_COOLDOWN_SECONDS='300';
      SYMBOL_FATIGUE_MAX_TRADES_PER_WINDOW='9';
      SYMBOL_FATIGUE_MAX_LOSS_STREAK='5';
      SYMBOL_FATIGUE_COOLDOWN_SECONDS='300';
      EV_FIRST_ENTRY_MIN_NET_USD='0.0005';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.05';
      V2_ROLLING_EDGE_TIGHTEN_STEP_USD='0.0012';
      V2_ROLLING_EDGE_TIGHTEN_STEP_PERCENT='0.05';
      V2_ROLLING_EDGE_LOSS_SHARE_TIGHTEN='0.75';
      AUTO_TRADE_TOP_N='16';
      MAX_BUYS_PER_HOUR='58';
    }
  },
  @{ name='mx21_quality_aggressive'; base='mx19_v2_aggressive'; overrides=@{
      # Quality-gate aggressive: wider explore/probes, still controlled by EV filters.
      V2_QUALITY_GATE_ENABLED='true';
      V2_QUALITY_REFRESH_SECONDS='1500';
      V2_QUALITY_WINDOW_SECONDS='14400';
      V2_QUALITY_MIN_SYMBOL_TRADES='10';
      V2_QUALITY_MIN_CLUSTER_TRADES='14';
      V2_QUALITY_MIN_AVG_PNL_USD='0.0000';
      V2_QUALITY_MAX_LOSS_SHARE='0.62';
      V2_QUALITY_BAD_AVG_PNL_USD='-0.0010';
      V2_QUALITY_BAD_LOSS_SHARE='0.69';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.22';
      V2_QUALITY_EXPLORE_MIN_ABS='1';
      V2_QUALITY_COOLDOWN_PROBE_PROBABILITY='0.18';
      V2_QUALITY_COOLDOWN_SIZE_MULT='0.58';
      V2_QUALITY_COOLDOWN_HOLD_MULT='0.78';
      V2_QUALITY_COOLDOWN_EDGE_USD_MULT='1.30';
      V2_QUALITY_COOLDOWN_EDGE_PERCENT_MULT='1.24';
      V2_QUALITY_SYMBOL_CONCENTRATION_WINDOW_SECONDS='3600';
      V2_QUALITY_SYMBOL_MAX_SHARE='0.12';
      V2_QUALITY_SYMBOL_MIN_ABS_CAP='2';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='true';
      V2_QUALITY_SOURCE_MIN_TRADES='9';
      V2_QUALITY_SOURCE_WINDOW_SECONDS='14400';
      V2_QUALITY_SOURCE_GOOD_AVG_PNL_USD='0.0020';
      V2_QUALITY_SOURCE_BAD_AVG_PNL_USD='-0.0017';
      V2_QUALITY_SOURCE_BOOST_MULT='1.35';
      V2_QUALITY_SOURCE_CUT_MULT='0.60';
      V2_QUALITY_SOURCE_MIN_SHARE='0.06';
      V2_QUALITY_LOG_TOP_SYMBOLS='8';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.28';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.34';
      PROFILE_AUTOSTOP_ENABLED='false';
      SYMBOL_EV_GUARD_ENABLED='true';
      SYMBOL_EV_MIN_TRADES='5';
      SYMBOL_EV_MIN_AVG_PNL_USD='-0.0010';
      SYMBOL_EV_MAX_LOSS_SHARE='0.78';
      SYMBOL_EV_BAD_TO_STRICT_ONLY='false';
      SYMBOL_EV_BAD_ACTION='degrade';
      SYMBOL_EV_BAD_COOLDOWN_SECONDS='240';
      SYMBOL_FATIGUE_MAX_TRADES_PER_WINDOW='11';
      SYMBOL_FATIGUE_MAX_LOSS_STREAK='5';
      SYMBOL_FATIGUE_COOLDOWN_SECONDS='240';
      EV_FIRST_ENTRY_MIN_NET_USD='0.0005';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.00';
      V2_ROLLING_EDGE_TIGHTEN_STEP_USD='0.0012';
      V2_ROLLING_EDGE_TIGHTEN_STEP_PERCENT='0.05';
      V2_ROLLING_EDGE_LOSS_SHARE_TIGHTEN='0.75';
      AUTO_TRADE_TOP_N='20';
      MAX_BUYS_PER_HOUR='72';
    }
  },
  @{ name='mx22_universe_balanced'; base='mx20_quality_balanced'; overrides=@{
      # Universe expansion balanced: broader non-watchlist intake + controlled surge lane.
      V2_UNIVERSE_SOURCE_CAPS='onchain:165,onchain+market:165,dexscreener:150,geckoterminal:150,watchlist:22,dex_boosts:85';
      V2_UNIVERSE_SOURCE_WEIGHTS='onchain:1.16,onchain+market:1.13,dexscreener:1.10,geckoterminal:1.11,watchlist:0.72,dex_boosts:1.25';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.38';
      V2_UNIVERSE_NOVELTY_MIN_ABS='3';
      V2_UNIVERSE_SURGE_ENABLED='true';
      V2_UNIVERSE_SURGE_MIN_ABS_CHANGE_5M='3.8';
      V2_UNIVERSE_SURGE_MIN_VOLUME_5M_USD='2200';
      V2_UNIVERSE_SURGE_MIN_VOL_TO_LIQ='0.05';
      V2_UNIVERSE_SURGE_RESERVE_SHARE='0.24';
      V2_UNIVERSE_SURGE_RESERVE_MIN_ABS='2';
      V2_UNIVERSE_SURGE_SIZE_MULT='0.84';
      V2_UNIVERSE_SURGE_HOLD_MULT='0.90';
      V2_UNIVERSE_SURGE_EDGE_USD_MULT='1.04';
      V2_UNIVERSE_SURGE_EDGE_PERCENT_MULT='1.03';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.20';
      AUTO_TRADE_TOP_N='18';
      MAX_BUYS_PER_HOUR='64';
    }
  },
  @{ name='mx23_universe_aggressive'; base='mx21_quality_aggressive'; overrides=@{
      # Universe expansion aggressive: maximize new strong movers while preserving risk throttles.
      V2_UNIVERSE_SOURCE_CAPS='onchain:185,onchain+market:185,dexscreener:170,geckoterminal:170,watchlist:18,dex_boosts:110';
      V2_UNIVERSE_SOURCE_WEIGHTS='onchain:1.18,onchain+market:1.15,dexscreener:1.12,geckoterminal:1.12,watchlist:0.68,dex_boosts:1.30';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.42';
      V2_UNIVERSE_NOVELTY_MIN_ABS='4';
      V2_UNIVERSE_SURGE_ENABLED='true';
      V2_UNIVERSE_SURGE_MIN_ABS_CHANGE_5M='3.2';
      V2_UNIVERSE_SURGE_MIN_VOLUME_5M_USD='1800';
      V2_UNIVERSE_SURGE_MIN_VOL_TO_LIQ='0.045';
      V2_UNIVERSE_SURGE_RESERVE_SHARE='0.30';
      V2_UNIVERSE_SURGE_RESERVE_MIN_ABS='3';
      V2_UNIVERSE_SURGE_SIZE_MULT='0.88';
      V2_UNIVERSE_SURGE_HOLD_MULT='0.92';
      V2_UNIVERSE_SURGE_EDGE_USD_MULT='1.02';
      V2_UNIVERSE_SURGE_EDGE_PERCENT_MULT='1.02';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.26';
      AUTO_TRADE_TOP_N='22';
      MAX_BUYS_PER_HOUR='84';
    }
  },
  @{ name='mx24_winner_lock'; base='mx22_universe_balanced'; overrides=@{
      # Winner-derived lock profile: keep flow, protect accumulated profit earlier.
      EV_FIRST_ENTRY_MIN_NET_USD='0.0007';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.10';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.05';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.45';
      PAPER_PARTIAL_TP_STAGE2_TRIGGER_MULT='1.55';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.34';
      PAPER_TRAILING_ACTIVATE_PEAK_PERCENT='1.10';
      PAPER_TRAILING_GIVEBACK_PERCENT='0.78';
      PAPER_TRAILING_GIVEBACK_RATIO='0.50';
      PAPER_TRAILING_MIN_PNL_PERCENT='0.10';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.10';
      WEAKNESS_EXIT_PNL_PERCENT='-2.55';
      EXIT_TIMEOUT_EXTENSION_MAX_SECONDS='38';
      EXIT_TIMEOUT_EXTENSION_MIN_PNL_PERCENT='0.12';
      HOLD_MAX_SECONDS='152';
      PAPER_MAX_HOLD_SECONDS='158';
      MAX_BUYS_PER_HOUR='62';
      AUTO_TRADE_TOP_N='18';
    }
  },
  @{ name='mx25_winner_runner'; base='mx22_universe_balanced'; overrides=@{
      # Winner-derived runner profile: hold strong winners longer with softer harvest.
      EV_FIRST_ENTRY_MIN_NET_USD='0.0008';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.16';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.30';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.30';
      PAPER_PARTIAL_TP_STAGE2_TRIGGER_MULT='1.90';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.30';
      PAPER_TRAILING_ACTIVATE_PEAK_PERCENT='1.45';
      PAPER_TRAILING_GIVEBACK_PERCENT='0.96';
      PAPER_TRAILING_GIVEBACK_RATIO='0.58';
      PAPER_TRAILING_MIN_PNL_PERCENT='0.16';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.22';
      WEAKNESS_EXIT_PNL_PERCENT='-2.85';
      EXIT_TIMEOUT_EXTENSION_MAX_SECONDS='68';
      EXIT_TIMEOUT_EXTENSION_MIN_PNL_PERCENT='0.20';
      HOLD_MAX_SECONDS='182';
      PAPER_MAX_HOLD_SECONDS='188';
      MAX_BUYS_PER_HOUR='66';
      AUTO_TRADE_TOP_N='20';
    }
  },
  @{ name='mx26_gold_reanchor_lock'; base='mx24_winner_lock'; overrides=@{
      # Gold-derived lock: dataset-anchored + anti-choke + session profit lock.
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='420';
      V2_CALIBRATION_MIN_CLOSED='80';
      V2_CALIBRATION_LOOKBACK_ROWS='3500';
      V2_CALIBRATION_SMOOTH_ALPHA='0.40';
      V2_CALIBRATION_REANCHOR_INTERVAL_SECONDS='10800';
      V2_CALIBRATION_REANCHOR_BLEND='0.26';
      SESSION_PROFIT_LOCK_ENABLED='true';
      SESSION_PROFIT_LOCK_ACTIVATE_USD='0.55';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.68';
      SESSION_PROFIT_LOCK_MIN_FLOOR_USD='0.22';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='900';
      ANTI_CHOKE_ENABLED='true';
      ANTI_CHOKE_IDLE_SECONDS='1100';
      ANTI_CHOKE_ALLOW_SYMBOL_COOLDOWN_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_FATIGUE_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_STRICT_BYPASS='true';
      SYMBOL_EV_WINDOW_MINUTES='150';
      SYMBOL_EV_MIN_TRADES='7';
      V2_QUALITY_SYMBOL_CONCENTRATION_WINDOW_SECONDS='3000';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.20';
      AUTO_TRADE_TOP_N='19';
      MAX_BUYS_PER_HOUR='64';
    }
  },
  @{ name='mx27_gold_reanchor_runner'; base='mx24_winner_lock'; overrides=@{
      # Gold-derived runner: same data anchors, slightly higher flow and longer winner life.
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='360';
      V2_CALIBRATION_MIN_CLOSED='70';
      V2_CALIBRATION_LOOKBACK_ROWS='4200';
      V2_CALIBRATION_SMOOTH_ALPHA='0.44';
      V2_CALIBRATION_REANCHOR_INTERVAL_SECONDS='9000';
      V2_CALIBRATION_REANCHOR_BLEND='0.28';
      SESSION_PROFIT_LOCK_ENABLED='true';
      SESSION_PROFIT_LOCK_ACTIVATE_USD='0.65';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.62';
      SESSION_PROFIT_LOCK_MIN_FLOOR_USD='0.24';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='780';
      ANTI_CHOKE_ENABLED='true';
      ANTI_CHOKE_IDLE_SECONDS='900';
      ANTI_CHOKE_ALLOW_SYMBOL_COOLDOWN_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_FATIGUE_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_STRICT_BYPASS='true';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.22';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.36';
      PAPER_TRAILING_ACTIVATE_PEAK_PERCENT='1.32';
      PAPER_TRAILING_GIVEBACK_PERCENT='0.90';
      PAPER_TRAILING_GIVEBACK_RATIO='0.54';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.16';
      EXIT_TIMEOUT_EXTENSION_MAX_SECONDS='62';
      HOLD_MAX_SECONDS='172';
      PAPER_MAX_HOLD_SECONDS='178';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.24';
      AUTO_TRADE_TOP_N='21';
      MAX_BUYS_PER_HOUR='72';
    }
  },
  @{ name='mx28_pool_rework_balanced'; base='mx22_universe_balanced'; overrides=@{
      # Pool rework balanced: guaranteed explore reserve + provisional A lane + anti-repeat by symbol.
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='420';
      V2_CALIBRATION_MIN_CLOSED='80';
      V2_CALIBRATION_LOOKBACK_ROWS='4200';
      V2_CALIBRATION_SMOOTH_ALPHA='0.40';
      V2_CALIBRATION_REANCHOR_INTERVAL_SECONDS='10800';
      V2_CALIBRATION_REANCHOR_BLEND='0.26';
      SESSION_PROFIT_LOCK_ENABLED='true';
      SESSION_PROFIT_LOCK_ACTIVATE_USD='0.55';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.66';
      SESSION_PROFIT_LOCK_MIN_FLOOR_USD='0.22';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='900';
      ANTI_CHOKE_ENABLED='true';
      ANTI_CHOKE_IDLE_SECONDS='900';
      ANTI_CHOKE_ALLOW_SYMBOL_COOLDOWN_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_FATIGUE_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_STRICT_BYPASS='true';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.44';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='3';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='6';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='240';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.24';
      V2_QUALITY_EXPLORE_RESERVE_SHARE='0.26';
      V2_QUALITY_EXPLORE_MIN_ABS='2';
      V2_QUALITY_SYMBOL_MAX_SHARE='0.08';
      V2_QUALITY_SYMBOL_REENTRY_MIN_SECONDS='420';
      V2_QUALITY_SYMBOL_REENTRY_OVERRIDE_VOL_MULT='2.6';
      V2_QUALITY_FRESH_SYMBOL_WINDOW_SECONDS='5400';
      V2_QUALITY_FRESH_SYMBOL_BOOST='3.2';
      V2_QUALITY_SOURCE_MIN_TRADES='8';
      V2_QUALITY_SOURCE_MIN_SHARE='0.10';
      V2_QUALITY_SOURCE_MAX_SHARE='0.52';
      V2_QUALITY_PROVISIONAL_CORE_ENABLED='true';
      V2_QUALITY_PROVISIONAL_CORE_MIN_SCORE='95';
      V2_QUALITY_PROVISIONAL_CORE_MIN_LIQUIDITY_USD='110000';
      V2_QUALITY_PROVISIONAL_CORE_MIN_VOLUME_5M_USD='3200';
      V2_QUALITY_PROVISIONAL_CORE_MIN_ABS_CHANGE_5M='2.6';
      V2_QUALITY_PROVISIONAL_CORE_MAX_SHARE='0.28';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.26';
      V2_ENTRY_CORE_MIN_PER_CYCLE='1';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='16';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.08';
      HOLD_MAX_SECONDS='170';
      PAPER_MAX_HOLD_SECONDS='176';
      MAX_BUYS_PER_HOUR='68';
      AUTO_TRADE_TOP_N='20';
      V2_KPI_FAST_ANTISTALL_ENABLED='false';
    }
  },
  @{ name='mx29_pool_rework_aggressive'; base='mx22_universe_balanced'; overrides=@{
      # Pool rework aggressive: wider novelty/throughput while keeping EV-first and anti-choke guards.
      V2_CALIBRATION_ENABLED='true';
      V2_CALIBRATION_INTERVAL_SECONDS='360';
      V2_CALIBRATION_MIN_CLOSED='70';
      V2_CALIBRATION_LOOKBACK_ROWS='5200';
      V2_CALIBRATION_SMOOTH_ALPHA='0.44';
      V2_CALIBRATION_REANCHOR_INTERVAL_SECONDS='9000';
      V2_CALIBRATION_REANCHOR_BLEND='0.30';
      SESSION_PROFIT_LOCK_ENABLED='true';
      SESSION_PROFIT_LOCK_ACTIVATE_USD='0.65';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.60';
      SESSION_PROFIT_LOCK_MIN_FLOOR_USD='0.24';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='780';
      ANTI_CHOKE_ENABLED='true';
      ANTI_CHOKE_IDLE_SECONDS='780';
      ANTI_CHOKE_ALLOW_SYMBOL_COOLDOWN_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_FATIGUE_BYPASS='true';
      ANTI_CHOKE_ALLOW_SYMBOL_STRICT_BYPASS='true';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.50';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='2';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='5';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='200';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.32';
      V2_QUALITY_EXPLORE_RESERVE_SHARE='0.34';
      V2_QUALITY_EXPLORE_MIN_ABS='3';
      V2_QUALITY_SYMBOL_MAX_SHARE='0.10';
      V2_QUALITY_SYMBOL_REENTRY_MIN_SECONDS='280';
      V2_QUALITY_SYMBOL_REENTRY_OVERRIDE_VOL_MULT='2.4';
      V2_QUALITY_FRESH_SYMBOL_WINDOW_SECONDS='4200';
      V2_QUALITY_FRESH_SYMBOL_BOOST='2.6';
      V2_QUALITY_SOURCE_MIN_TRADES='6';
      V2_QUALITY_SOURCE_MIN_SHARE='0.10';
      V2_QUALITY_SOURCE_MAX_SHARE='0.58';
      V2_QUALITY_PROVISIONAL_CORE_ENABLED='true';
      V2_QUALITY_PROVISIONAL_CORE_MIN_SCORE='93';
      V2_QUALITY_PROVISIONAL_CORE_MIN_LIQUIDITY_USD='90000';
      V2_QUALITY_PROVISIONAL_CORE_MIN_VOLUME_5M_USD='2800';
      V2_QUALITY_PROVISIONAL_CORE_MIN_ABS_CHANGE_5M='2.2';
      V2_QUALITY_PROVISIONAL_CORE_MAX_SHARE='0.36';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.34';
      V2_ENTRY_CORE_MIN_PER_CYCLE='1';
      NO_MOMENTUM_EXIT_MIN_AGE_PERCENT='14';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.12';
      HOLD_MAX_SECONDS='182';
      PAPER_MAX_HOLD_SECONDS='188';
      MAX_BUYS_PER_HOUR='84';
      AUTO_TRADE_TOP_N='24';
      V2_KPI_FAST_ANTISTALL_ENABLED='true';
    }
  },
  @{ name='mx30_guarded_balanced'; base='mx28_pool_rework_balanced'; overrides=@{
      # Anti-self-tighten guarded balanced profile.
      AUTO_TRADE_EXCLUDED_SYMBOLS='ZORA,DAIMON';
      V2_ANTI_SELF_TIGHTEN_ENABLED='true';
      V2_ANTI_SELF_TIGHTEN_OPEN_RATE_THRESHOLD='0.038';
      V2_ANTI_SELF_TIGHTEN_EDGE_LOW_SHARE_THRESHOLD='0.60';
      V2_ANTI_SELF_TIGHTEN_COOLDOWN_SECONDS='2100';
      V2_ROLLING_EDGE_MAX_TIGHTEN_PER_HOUR='1';
      V2_CALIBRATION_NO_TIGHTEN_DURING_RELAX_WINDOW='true';
      V2_CALIBRATION_NO_MOMENTUM_MAX_PNL_FLOOR='0.04';
      NO_MOMENTUM_STRONG_TRADE_PROTECT_ENABLED='true';
      NO_MOMENTUM_STRONG_EXPECTED_EDGE_PERCENT='2.7';
      NO_MOMENTUM_STRONG_MIN_AGE_EXTRA_PERCENT='20';
      NO_MOMENTUM_STRONG_MIN_HOLD_EXTRA_SECONDS='54';
      NO_MOMENTUM_STRONG_MAX_PNL_SHIFT='-0.12';
      EXIT_TIMEOUT_STRONG_TRADE_EXTRA_SECONDS='30';
      EXIT_TIMEOUT_STRONG_TRADE_MIN_EXPECTED_EDGE_PERCENT='2.7';
      EXIT_TIMEOUT_STRONG_TRADE_ALLOW_FOR_TIER_A='true';
      EXIT_TIMEOUT_STRONG_TRADE_ALLOW_FOR_CORE='true';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_ENABLED='true';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_PCT_MULT='0.93';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_USD_MULT='0.93';
      EV_FIRST_ENTRY_MIN_NET_USD_GREEN_A_CORE_MULT='0.94';
      ENTRY_A_CORE_MIN_TRADE_USD_ENABLED='true';
      ENTRY_A_CORE_MIN_TRADE_USD='0.45';
      ENTRY_A_CORE_MIN_TRADE_APPLY_IN_RED='false';
      ENTRY_SMALL_SIZE_EV_RELAX_ENABLED='true';
      ENTRY_SMALL_SIZE_EV_RELAX_NOMINAL_USD='1.00';
      ENTRY_SMALL_SIZE_EV_RELAX_MIN_FACTOR='0.45';
      ENTRY_SMALL_SIZE_EDGE_RELAX_ENABLED='true';
      ENTRY_SMALL_SIZE_EDGE_RELAX_NOMINAL_USD='1.00';
      ENTRY_SMALL_SIZE_EDGE_RELAX_MIN_FACTOR='0.45';
      EV_FIRST_ENTRY_MIN_NET_USD='0.00035';
      PAPER_GAS_PER_TX_USD='0.012';
      PAPER_APPROVE_TX_ALWAYS='false';
      PAPER_APPROVE_TX_PROBABILITY='0.28';
      EV_FIRST_ENTRY_CORE_PROBE_ENABLED='true';
      EV_FIRST_ENTRY_CORE_PROBE_RELAX_ONLY='true';
      EV_FIRST_ENTRY_CORE_PROBE_WINDOW_SECONDS='900';
      EV_FIRST_ENTRY_CORE_PROBE_MAX_OPENS='1';
      EV_FIRST_ENTRY_CORE_PROBE_MIN_NET_USD='-0.0010';
      EV_FIRST_ENTRY_CORE_PROBE_EV_TOLERANCE_USD='0.0026';
      EV_FIRST_ENTRY_CORE_PROBE_EDGE_PERCENT_RELAX_RATIO='0.18';
      EV_FIRST_ENTRY_CORE_PROBE_EDGE_USD_RELAX_ABS='0.0016';
      WEAK_TRADE_EARLY_EXIT_ENABLED='true';
      WEAK_TRADE_EARLY_EDGE_MAX_PERCENT='2.40';
      WEAK_TRADE_EARLY_MIN_AGE_PERCENT='20';
      WEAK_TRADE_EARLY_MIN_HOLD_SECONDS='52';
      WEAK_TRADE_EARLY_MAX_PNL_PERCENT='0.08';
      WEAK_TRADE_EARLY_MAX_PEAK_PERCENT='1.00';
      SYMBOL_CONCENTRATION_GUARD_ENABLED='true';
      SYMBOL_CONCENTRATION_WINDOW_SECONDS='3600';
      SYMBOL_CONCENTRATION_MIN_OPENS='20';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.18';
      SYMBOL_CONCENTRATION_TIER_A_SHARE_MULT='1.15';
      RISK_GOVERNOR_ADAPTIVE_PAUSE_ENABLED='true';
      RISK_GOVERNOR_PAUSE_GREEN_MULT='0.55';
      RISK_GOVERNOR_PAUSE_YELLOW_MULT='0.72';
      RISK_GOVERNOR_PAUSE_RED_MULT='0.90';
      RISK_GOVERNOR_PAUSE_MIN_SECONDS='45';
      RISK_GOVERNOR_PAUSE_MAX_SECONDS='900';
      RISK_GOVERNOR_ANTI_CHOKE_MAX_PAUSE_SECONDS='180';
      RISK_GOVERNOR_DRAWDOWN_MIN_PAUSE_SECONDS='240';
      SESSION_PROFIT_LOCK_USE_EQUITY_GUARD='true';
      SESSION_PROFIT_LOCK_USE_EQUITY_FOR_PEAK='false';
      SESSION_PROFIT_LOCK_MIN_RETRIGGER_SECONDS='420';
      SESSION_PROFIT_LOCK_REARM_BUFFER_USD='0.03';
      SESSION_PROFIT_LOCK_REARM_COOLDOWN_SECONDS='300';
      SESSION_PROFIT_LOCK_RESET_ON_NEW_DAY='true';
      PERSIST_TRADING_PAUSE_ON_RESTART='true';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='540';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.60';
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='2.55';
      EXECUTION_RUNNER_MIN_EV_USD='0.0054';
      EXECUTION_RUNNER_MIN_SCORE='91';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='false';
      EXECUTION_RUNNER_SIZE_MULT='1.10';
      EXECUTION_RUNNER_HOLD_MULT='1.38';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.93';
      EXECUTION_SCALP_SIZE_MULT='0.90';
      EXECUTION_SCALP_HOLD_MULT='0.76';
      EXECUTION_SCALP_EDGE_GATE_MULT='1.08';
      EXECUTION_CLUSTER_ROUTING_ENABLED='true';
      EXECUTION_CLUSTER_ROUTING_MIN_TRADES='12';
      EXECUTION_CLUSTER_ROUTING_BAD_AVG_NET_USD='-0.00015';
      EXECUTION_CLUSTER_ROUTING_BAD_LOSS_SHARE='0.61';
      EXECUTION_CLUSTER_ROUTING_SEVERE_AVG_NET_USD='-0.0010';
      EXECUTION_CLUSTER_ROUTING_SEVERE_LOSS_SHARE='0.73';
      EXECUTION_CLUSTER_ROUTING_BAD_SIZE_MULT='0.82';
      EXECUTION_CLUSTER_ROUTING_BAD_HOLD_MULT='0.90';
      EXECUTION_CLUSTER_ROUTING_BAD_EDGE_MULT='1.10';
      EXECUTION_CLUSTER_ROUTING_BAD_ENTRY_PROBABILITY='0.78';
      EXECUTION_CLUSTER_ROUTING_SEVERE_SIZE_MULT='0.58';
      EXECUTION_CLUSTER_ROUTING_SEVERE_HOLD_MULT='0.70';
      EXECUTION_CLUSTER_ROUTING_SEVERE_EDGE_MULT='1.27';
      EXECUTION_CLUSTER_ROUTING_SEVERE_ENTRY_PROBABILITY='0.46';
      EXECUTION_CLUSTER_ROUTING_A_CORE_RELAX_EDGE_MULT='0.93';
      STATEFUL_EXITS_ENABLED='true';
      STATEFUL_EXITS_EARLY_PHASE_RATIO='0.32';
      STATEFUL_EXITS_LATE_PHASE_RATIO='0.80';
      STATEFUL_TIMEOUT_RUNNER_EXTRA_SECONDS='30';
      STATEFUL_TIMEOUT_SCALP_REDUCE_SECONDS='16';
      STATEFUL_NO_MOMENTUM_RUNNER_AGE_SHIFT_SECONDS='26';
      STATEFUL_NO_MOMENTUM_RUNNER_PNL_SHIFT='-0.12';
      STATEFUL_NO_MOMENTUM_SCALP_AGE_SHIFT_SECONDS='-12';
      STATEFUL_NO_MOMENTUM_SCALP_PNL_SHIFT='0.05';
      STATEFUL_WEAK_EARLY_RUNNER_EDGE_BONUS_PERCENT='0.35';
      STATEFUL_WEAK_EARLY_SCALP_EDGE_PENALTY_PERCENT='0.30';
      STATEFUL_PRE_PARTIAL_RUNNER_MIN_AGE_EXTRA_SECONDS='16';
      STATEFUL_PRE_PARTIAL_RUNNER_MAX_LOSS_SHIFT='-0.20';
      STATEFUL_PRE_PARTIAL_SCALP_MIN_AGE_SHIFT_SECONDS='-10';
      STATEFUL_PRE_PARTIAL_SCALP_MAX_LOSS_SHIFT='0.18';
      STATEFUL_POST_PARTIAL_RUNNER_GIVEBACK_MULT='0.78';
      STATEFUL_POST_PARTIAL_SCALP_GIVEBACK_MULT='1.10';
      MIN_EXPECTED_EDGE_USD='0.0098';
      MIN_EXPECTED_EDGE_PERCENT='0.58';
      SAFE_MIN_VOLUME_5M_USD='40';
      V2_KPI_EDGE_LOW_HARD_TRIGGER='0.78';
      V2_KPI_QUALITY_REBALANCE_ENABLED='true';
      V2_KPI_QUALITY_REBALANCE_EXPLORE_STEP='0.04';
      V2_KPI_QUALITY_REBALANCE_NOVELTY_STEP='0.03';
      V2_KPI_QUALITY_REBALANCE_TOPN_STEP='1';
      V2_KPI_QUALITY_REBALANCE_MAX_BUYS_STEP='4';
      V2_QUALITY_CORE_MIN_ABS='1';
      V2_QUALITY_CORE_FALLBACK_FROM_EXPLORE_ENABLED='true';
      V2_QUALITY_CORE_FALLBACK_SCORE_MIN='90';
      V2_QUALITY_CORE_FALLBACK_MAX_SHARE='0.22';
      V2_CALIBRATION_CLAMP_ENABLED='true';
      V2_CALIBRATION_EDGE_PERCENT_MAX_FROM_BASE='0.06';
      V2_CALIBRATION_EDGE_PERCENT_MIN_FROM_BASE='0.08';
      V2_CALIBRATION_EDGE_USD_MAX_FROM_BASE='0.0018';
      V2_CALIBRATION_EDGE_USD_MIN_FROM_BASE='0.0022';
      V2_CALIBRATION_SAFE_VOLUME_MAX_FROM_BASE='45';
      V2_CALIBRATION_NO_MOMENTUM_MIN='0.10';
      V2_CALIBRATION_WEAKNESS_MAX_NEG_DRIFT='0.30';
      V2_CALIBRATION_HOLD_MAX_ABS='245';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='true';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.00';
      WEAKNESS_EXIT_PNL_PERCENT='-2.75';
      HOLD_MAX_SECONDS='175';
      MAX_BUYS_PER_HOUR='76';
      AUTO_TRADE_TOP_N='23';
      V2_UNIVERSE_MAX_TOTAL_PER_CYCLE='160';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.28';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.15';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.40';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.35';
      PAPER_MAX_HOLD_SECONDS='168';
    }
  },
  @{ name='mx31_guarded_aggressive'; base='mx29_pool_rework_aggressive'; overrides=@{
      # Anti-self-tighten guarded aggressive profile.
      AUTO_TRADE_EXCLUDED_SYMBOLS='ZORA,DAIMON';
      V2_ANTI_SELF_TIGHTEN_ENABLED='true';
      V2_ANTI_SELF_TIGHTEN_OPEN_RATE_THRESHOLD='0.036';
      V2_ANTI_SELF_TIGHTEN_EDGE_LOW_SHARE_THRESHOLD='0.58';
      V2_ANTI_SELF_TIGHTEN_COOLDOWN_SECONDS='1800';
      V2_ROLLING_EDGE_MAX_TIGHTEN_PER_HOUR='1';
      V2_CALIBRATION_NO_TIGHTEN_DURING_RELAX_WINDOW='true';
      V2_CALIBRATION_NO_MOMENTUM_MAX_PNL_FLOOR='0.05';
      NO_MOMENTUM_STRONG_TRADE_PROTECT_ENABLED='true';
      NO_MOMENTUM_STRONG_EXPECTED_EDGE_PERCENT='2.6';
      NO_MOMENTUM_STRONG_MIN_AGE_EXTRA_PERCENT='18';
      NO_MOMENTUM_STRONG_MIN_HOLD_EXTRA_SECONDS='48';
      NO_MOMENTUM_STRONG_MAX_PNL_SHIFT='-0.10';
      EXIT_TIMEOUT_STRONG_TRADE_EXTRA_SECONDS='28';
      EXIT_TIMEOUT_STRONG_TRADE_MIN_EXPECTED_EDGE_PERCENT='2.6';
      EXIT_TIMEOUT_STRONG_TRADE_ALLOW_FOR_TIER_A='true';
      EXIT_TIMEOUT_STRONG_TRADE_ALLOW_FOR_CORE='true';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_ENABLED='true';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_PCT_MULT='0.91';
      ENTRY_EDGE_SOFTEN_GREEN_A_CORE_USD_MULT='0.91';
      EV_FIRST_ENTRY_MIN_NET_USD_GREEN_A_CORE_MULT='0.92';
      ENTRY_A_CORE_MIN_TRADE_USD_ENABLED='true';
      ENTRY_A_CORE_MIN_TRADE_USD='0.44';
      ENTRY_A_CORE_MIN_TRADE_APPLY_IN_RED='false';
      ENTRY_SMALL_SIZE_EV_RELAX_ENABLED='true';
      ENTRY_SMALL_SIZE_EV_RELAX_NOMINAL_USD='1.00';
      ENTRY_SMALL_SIZE_EV_RELAX_MIN_FACTOR='0.52';
      ENTRY_SMALL_SIZE_EDGE_RELAX_ENABLED='true';
      ENTRY_SMALL_SIZE_EDGE_RELAX_NOMINAL_USD='1.00';
      ENTRY_SMALL_SIZE_EDGE_RELAX_MIN_FACTOR='0.48';
      PAPER_GAS_PER_TX_USD='0.012';
      PAPER_APPROVE_TX_ALWAYS='false';
      PAPER_APPROVE_TX_PROBABILITY='0.30';
      EV_FIRST_ENTRY_CORE_PROBE_ENABLED='true';
      EV_FIRST_ENTRY_CORE_PROBE_RELAX_ONLY='true';
      EV_FIRST_ENTRY_CORE_PROBE_WINDOW_SECONDS='900';
      EV_FIRST_ENTRY_CORE_PROBE_MAX_OPENS='2';
      EV_FIRST_ENTRY_CORE_PROBE_MIN_NET_USD='-0.0012';
      EV_FIRST_ENTRY_CORE_PROBE_EV_TOLERANCE_USD='0.0030';
      EV_FIRST_ENTRY_CORE_PROBE_EDGE_PERCENT_RELAX_RATIO='0.22';
      EV_FIRST_ENTRY_CORE_PROBE_EDGE_USD_RELAX_ABS='0.0019';
      WEAK_TRADE_EARLY_EXIT_ENABLED='true';
      WEAK_TRADE_EARLY_EDGE_MAX_PERCENT='2.60';
      WEAK_TRADE_EARLY_MIN_AGE_PERCENT='18';
      WEAK_TRADE_EARLY_MIN_HOLD_SECONDS='45';
      WEAK_TRADE_EARLY_MAX_PNL_PERCENT='0.10';
      WEAK_TRADE_EARLY_MAX_PEAK_PERCENT='1.10';
      SYMBOL_CONCENTRATION_GUARD_ENABLED='true';
      SYMBOL_CONCENTRATION_WINDOW_SECONDS='3600';
      SYMBOL_CONCENTRATION_MIN_OPENS='20';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.19';
      SYMBOL_CONCENTRATION_TIER_A_SHARE_MULT='1.20';
      RISK_GOVERNOR_ADAPTIVE_PAUSE_ENABLED='true';
      RISK_GOVERNOR_PAUSE_GREEN_MULT='0.50';
      RISK_GOVERNOR_PAUSE_YELLOW_MULT='0.68';
      RISK_GOVERNOR_PAUSE_RED_MULT='0.85';
      RISK_GOVERNOR_PAUSE_MIN_SECONDS='40';
      RISK_GOVERNOR_PAUSE_MAX_SECONDS='780';
      RISK_GOVERNOR_ANTI_CHOKE_MAX_PAUSE_SECONDS='150';
      RISK_GOVERNOR_DRAWDOWN_MIN_PAUSE_SECONDS='210';
      SESSION_PROFIT_LOCK_USE_EQUITY_GUARD='true';
      SESSION_PROFIT_LOCK_USE_EQUITY_FOR_PEAK='false';
      SESSION_PROFIT_LOCK_MIN_RETRIGGER_SECONDS='360';
      SESSION_PROFIT_LOCK_REARM_BUFFER_USD='0.035';
      SESSION_PROFIT_LOCK_REARM_COOLDOWN_SECONDS='300';
      SESSION_PROFIT_LOCK_RESET_ON_NEW_DAY='true';
      PERSIST_TRADING_PAUSE_ON_RESTART='true';
      SESSION_PROFIT_LOCK_PAUSE_SECONDS='480';
      SESSION_PROFIT_LOCK_KEEP_RATIO='0.58';
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='2.40';
      EXECUTION_RUNNER_MIN_EV_USD='0.0046';
      EXECUTION_RUNNER_MIN_SCORE='89';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='true';
      EXECUTION_RUNNER_SIZE_MULT='1.14';
      EXECUTION_RUNNER_HOLD_MULT='1.42';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.91';
      EXECUTION_SCALP_SIZE_MULT='0.94';
      EXECUTION_SCALP_HOLD_MULT='0.80';
      EXECUTION_SCALP_EDGE_GATE_MULT='1.05';
      EXECUTION_CLUSTER_ROUTING_ENABLED='true';
      EXECUTION_CLUSTER_ROUTING_MIN_TRADES='10';
      EXECUTION_CLUSTER_ROUTING_BAD_AVG_NET_USD='-0.00020';
      EXECUTION_CLUSTER_ROUTING_BAD_LOSS_SHARE='0.62';
      EXECUTION_CLUSTER_ROUTING_SEVERE_AVG_NET_USD='-0.0011';
      EXECUTION_CLUSTER_ROUTING_SEVERE_LOSS_SHARE='0.74';
      EXECUTION_CLUSTER_ROUTING_BAD_SIZE_MULT='0.86';
      EXECUTION_CLUSTER_ROUTING_BAD_HOLD_MULT='0.92';
      EXECUTION_CLUSTER_ROUTING_BAD_EDGE_MULT='1.08';
      EXECUTION_CLUSTER_ROUTING_BAD_ENTRY_PROBABILITY='0.82';
      EXECUTION_CLUSTER_ROUTING_SEVERE_SIZE_MULT='0.60';
      EXECUTION_CLUSTER_ROUTING_SEVERE_HOLD_MULT='0.74';
      EXECUTION_CLUSTER_ROUTING_SEVERE_EDGE_MULT='1.24';
      EXECUTION_CLUSTER_ROUTING_SEVERE_ENTRY_PROBABILITY='0.50';
      EXECUTION_CLUSTER_ROUTING_A_CORE_RELAX_EDGE_MULT='0.94';
      STATEFUL_EXITS_ENABLED='true';
      STATEFUL_EXITS_EARLY_PHASE_RATIO='0.30';
      STATEFUL_EXITS_LATE_PHASE_RATIO='0.76';
      STATEFUL_TIMEOUT_RUNNER_EXTRA_SECONDS='26';
      STATEFUL_TIMEOUT_SCALP_REDUCE_SECONDS='12';
      STATEFUL_NO_MOMENTUM_RUNNER_AGE_SHIFT_SECONDS='22';
      STATEFUL_NO_MOMENTUM_RUNNER_PNL_SHIFT='-0.10';
      STATEFUL_NO_MOMENTUM_SCALP_AGE_SHIFT_SECONDS='-10';
      STATEFUL_NO_MOMENTUM_SCALP_PNL_SHIFT='0.04';
      STATEFUL_WEAK_EARLY_RUNNER_EDGE_BONUS_PERCENT='0.30';
      STATEFUL_WEAK_EARLY_SCALP_EDGE_PENALTY_PERCENT='0.25';
      STATEFUL_PRE_PARTIAL_RUNNER_MIN_AGE_EXTRA_SECONDS='14';
      STATEFUL_PRE_PARTIAL_RUNNER_MAX_LOSS_SHIFT='-0.18';
      STATEFUL_PRE_PARTIAL_SCALP_MIN_AGE_SHIFT_SECONDS='-8';
      STATEFUL_PRE_PARTIAL_SCALP_MAX_LOSS_SHIFT='0.14';
      STATEFUL_POST_PARTIAL_RUNNER_GIVEBACK_MULT='0.82';
      STATEFUL_POST_PARTIAL_SCALP_GIVEBACK_MULT='1.08';
      MIN_EXPECTED_EDGE_USD='0.0105';
      MIN_EXPECTED_EDGE_PERCENT='0.56';
      SAFE_MIN_VOLUME_5M_USD='34';
      V2_KPI_EDGE_LOW_HARD_TRIGGER='0.78';
      V2_KPI_QUALITY_REBALANCE_ENABLED='true';
      V2_KPI_QUALITY_REBALANCE_EXPLORE_STEP='0.04';
      V2_KPI_QUALITY_REBALANCE_NOVELTY_STEP='0.03';
      V2_KPI_QUALITY_REBALANCE_TOPN_STEP='1';
      V2_KPI_QUALITY_REBALANCE_MAX_BUYS_STEP='4';
      V2_QUALITY_CORE_MIN_ABS='1';
      V2_QUALITY_CORE_FALLBACK_FROM_EXPLORE_ENABLED='true';
      V2_QUALITY_CORE_FALLBACK_SCORE_MIN='89';
      V2_QUALITY_CORE_FALLBACK_MAX_SHARE='0.24';
      V2_CALIBRATION_CLAMP_ENABLED='true';
      V2_CALIBRATION_EDGE_PERCENT_MAX_FROM_BASE='0.06';
      V2_CALIBRATION_EDGE_PERCENT_MIN_FROM_BASE='0.08';
      V2_CALIBRATION_EDGE_USD_MAX_FROM_BASE='0.0018';
      V2_CALIBRATION_EDGE_USD_MIN_FROM_BASE='0.0022';
      V2_CALIBRATION_SAFE_VOLUME_MAX_FROM_BASE='45';
      V2_CALIBRATION_NO_MOMENTUM_MIN='0.10';
      V2_CALIBRATION_WEAKNESS_MAX_NEG_DRIFT='0.30';
      V2_CALIBRATION_HOLD_MAX_ABS='250';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='true';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.00';
      WEAKNESS_EXIT_PNL_PERCENT='-2.75';
      HOLD_MAX_SECONDS='175';
      MAX_BUYS_PER_HOUR='88';
      AUTO_TRADE_TOP_N='26';
      V2_UNIVERSE_MAX_TOTAL_PER_CYCLE='175';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.34';
      PAPER_PARTIAL_TP_TRIGGER_PERCENT='1.15';
      PAPER_PARTIAL_TP_SELL_FRACTION='0.40';
      PAPER_PARTIAL_TP_STAGE2_SELL_FRACTION='0.35';
      PAPER_MAX_HOLD_SECONDS='176';
    }
  },
  @{ name='mx32_profit_stable'; base='mx29_pool_rework_aggressive'; overrides=@{
      # Profit-first stable profile: higher throughput with hard 2h profitability gate.
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='2.10';
      EXECUTION_RUNNER_MIN_EV_USD='0.0035';
      EXECUTION_RUNNER_MIN_SCORE='86';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='true';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.90';
      MIN_EXPECTED_EDGE_USD='0.0090';
      MIN_EXPECTED_EDGE_PERCENT='0.45';
      SAFE_MIN_VOLUME_5M_USD='30';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='false';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.40';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.40';
      SYMBOL_CONCENTRATION_MIN_OPENS='30';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.26';
      MAX_OPEN_TRADES='6';
      MAX_BUYS_PER_HOUR='120';
      AUTO_TRADE_TOP_N='34';
      PAPER_TRADE_SIZE_MAX_USD='1.15';
      HOLD_MAX_SECONDS='205';
      PAPER_MAX_HOLD_SECONDS='210';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.35';
      WEAKNESS_EXIT_PNL_PERCENT='-3.40';
      SESSION_PROFIT_LOCK_ENABLED='false';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='7200';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='30';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='1.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0050';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.56';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.45';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='1';
    }
  },
  @{ name='mx33_profit_aggressive'; base='mx29_pool_rework_aggressive'; overrides=@{
      # Profit-first aggressive profile: max flow, kill run if 2h profit floor missed.
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='1.95';
      EXECUTION_RUNNER_MIN_EV_USD='0.0030';
      EXECUTION_RUNNER_MIN_SCORE='84';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='true';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.88';
      MIN_EXPECTED_EDGE_USD='0.0080';
      MIN_EXPECTED_EDGE_PERCENT='0.40';
      SAFE_MIN_VOLUME_5M_USD='24';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='false';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.46';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.46';
      SYMBOL_CONCENTRATION_MIN_OPENS='36';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.30';
      MAX_OPEN_TRADES='7';
      MAX_BUYS_PER_HOUR='144';
      AUTO_TRADE_TOP_N='40';
      PAPER_TRADE_SIZE_MAX_USD='1.35';
      HOLD_MAX_SECONDS='220';
      PAPER_MAX_HOLD_SECONDS='225';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.40';
      WEAKNESS_EXIT_PNL_PERCENT='-3.60';
      SESSION_PROFIT_LOCK_ENABLED='false';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='7200';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='34';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='1.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0050';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.58';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.55';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='1';
    }
  },
  @{ name='mx34_breath_baseline'; base='mx29_pool_rework_aggressive'; overrides=@{
      # Breath profile (moderate loosen): keep nightly baseline logic, expand flow and diversify symbols.
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='1.78';
      EXECUTION_RUNNER_MIN_EV_USD='0.0025';
      EXECUTION_RUNNER_MIN_SCORE='82';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='true';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.86';
      MIN_EXPECTED_EDGE_USD='0.0075';
      MIN_EXPECTED_EDGE_PERCENT='0.34';
      SAFE_MIN_VOLUME_5M_USD='18';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='false';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.52';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.50';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.56';
      SYMBOL_CONCENTRATION_MIN_OPENS='24';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.22';
      MAX_OPEN_TRADES='8';
      MAX_BUYS_PER_HOUR='156';
      AUTO_TRADE_TOP_N='44';
      PAPER_TRADE_SIZE_MAX_USD='1.10';
      HOLD_MAX_SECONDS='210';
      PAPER_MAX_HOLD_SECONDS='215';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.42';
      WEAKNESS_EXIT_PNL_PERCENT='-3.70';
      SESSION_PROFIT_LOCK_ENABLED='false';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='7200';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='32';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='1.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0050';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.60';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.60';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='1';
    }
  },
  @{ name='mx35_breath_aggressive'; base='mx29_pool_rework_aggressive'; overrides=@{
      # Breath profile (high loosen): maximum active flow with tighter anti-concentration controls.
      V2_CALIBRATION_ENABLED='false';
      EXECUTION_ARCH_ENABLED='true';
      EXECUTION_DUAL_LANE_ENABLED='true';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='1.45';
      EXECUTION_RUNNER_MIN_EV_USD='0.0012';
      EXECUTION_RUNNER_MIN_SCORE='80';
      EXECUTION_RUNNER_ALLOW_IN_RED='false';
      EXECUTION_RUNNER_ALLOW_EXPLORE='true';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.80';
      MIN_EXPECTED_EDGE_USD='0.0048';
      MIN_EXPECTED_EDGE_PERCENT='0.24';
      SAFE_MIN_VOLUME_5M_USD='14';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='false';
      V2_SAFETY_BUDGET_ENABLED='false';
      V2_ENTRY_EXPLORE_MAX_SHARE='0.58';
      V2_QUALITY_EXPLORE_MAX_SHARE='0.56';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.68';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='360';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='1';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='2';
      SYMBOL_CONCENTRATION_MIN_OPENS='20';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.15';
      MAX_OPEN_TRADES='9';
      MAX_BUYS_PER_HOUR='184';
      AUTO_TRADE_TOP_N='52';
      PAPER_TRADE_SIZE_MAX_USD='1.05';
      HOLD_MAX_SECONDS='220';
      PAPER_MAX_HOLD_SECONDS='225';
      NO_MOMENTUM_EXIT_MAX_PNL_PERCENT='0.46';
      WEAKNESS_EXIT_PNL_PERCENT='-3.90';
      SESSION_PROFIT_LOCK_ENABLED='false';
      PROFILE_AUTOSTOP_ENABLED='true';
      PROFILE_AUTOSTOP_NOTIFY_ENABLED='true';
      PROFILE_AUTOSTOP_EVAL_INTERVAL_SECONDS='120';
      PROFILE_AUTOSTOP_MIN_RUNTIME_SECONDS='7200';
      PROFILE_AUTOSTOP_MIN_CLOSED_TRADES='36';
      PROFILE_AUTOSTOP_MIN_REALIZED_PNL_USD='1.00';
      PROFILE_AUTOSTOP_MIN_AVG_PNL_PER_TRADE_USD='0.0050';
      PROFILE_AUTOSTOP_MAX_LOSS_SHARE='0.62';
      PROFILE_AUTOSTOP_MAX_DRAWDOWN_FROM_PEAK_USD='0.70';
      PROFILE_AUTOSTOP_MIN_FAIL_SIGNALS='1';
    }
  },
  @{ name='mx36_diversity_probe'; base='mx35_breath_aggressive'; overrides=@{
      # Diversity probe v2: keep high throughput, but restore stricter EV quality at entry.
      V2_CALIBRATION_ENABLED='false';
      V2_ENTRY_DUAL_CHANNEL_ENABLED='false';
      AUTO_TRADE_EXCLUDED_SYMBOLS='ZORA,DAIMON';
      EXECUTION_RUNNER_MIN_EDGE_PERCENT='1.35';
      EXECUTION_RUNNER_MIN_EV_USD='0.0016';
      EXECUTION_RUNNER_EDGE_GATE_MULT='0.82';
      MIN_EXPECTED_EDGE_USD='0.0052';
      MIN_EXPECTED_EDGE_PERCENT='0.26';
      EV_FIRST_ENTRY_MIN_NET_USD='0.0008';
      EV_FIRST_ENTRY_MIN_NET_USD_EXPLORE_MULT='1.10';
      AUTO_TRADE_TOP_N='110';
      MAX_OPEN_TRADES='14';
      MAX_BUYS_PER_HOUR='320';
      MAX_TOKEN_COOLDOWN_SECONDS='35';
      AUTO_TRADE_TOKEN_COOLDOWN_DYNAMIC_ENABLED='false';
      AUTO_TRADE_TOKEN_COOLDOWN_MAX_SECONDS='420';
      AUTO_TRADE_TOKEN_COOLDOWN_STEP_SECONDS='90';
      V2_ENTRY_EXPLORE_MAX_PER_CYCLE='9';
      V2_UNIVERSE_NOVELTY_MIN_SHARE='0.32';
      V2_UNIVERSE_PASS_REPEAT_COOLDOWN_SECONDS='45';
      V2_UNIVERSE_SYMBOL_REPEAT_SOFT_CAP='1';
      V2_UNIVERSE_SYMBOL_REPEAT_HARD_CAP='3';
      SYMBOL_CONCENTRATION_MAX_SHARE='0.12';
      V2_QUALITY_SOURCE_BUDGET_ENABLED='true';
    }
  }
)

function ConvertTo-StringHashtable {
  param(
    $InputObject
  )
  $result = @{}
  if ($null -eq $InputObject) {
    return $result
  }
  if ($InputObject -is [hashtable]) {
    foreach ($k in $InputObject.Keys) {
      if ([string]::IsNullOrWhiteSpace([string]$k)) { continue }
      $result[[string]$k] = [string]$InputObject[$k]
    }
    return $result
  }
  if ($InputObject -is [System.Collections.IDictionary]) {
    foreach ($entry in $InputObject.GetEnumerator()) {
      $k = [string]$entry.Key
      if ([string]::IsNullOrWhiteSpace($k)) { continue }
      $result[$k] = [string]$entry.Value
    }
    return $result
  }
  if ($InputObject -is [System.Management.Automation.PSObject]) {
    foreach ($prop in $InputObject.PSObject.Properties) {
      $k = [string]$prop.Name
      if ([string]::IsNullOrWhiteSpace($k)) { continue }
      $result[$k] = [string]$prop.Value
    }
    return $result
  }
  throw "User preset overrides must be an object map."
}

function Get-UserPresetVariants {
  param(
    [string]$RootPath,
    [hashtable]$BuiltinNames,
    [string]$PythonPath
  )
  $out = @()
  $dir = Join-Path $RootPath 'data\matrix\user_presets'
  if (-not (Test-Path $dir)) {
    return $out
  }

  $files = Get-ChildItem -Path $dir -Filter '*.json' -File -ErrorAction SilentlyContinue | Sort-Object Name
  $guardScript = Join-Path $RootPath 'tools\matrix_preset_guard.py'
  foreach ($f in @($files)) {
    try {
      if ((Test-Path $guardScript) -and (Test-Path $PythonPath)) {
        $guardOut = & $PythonPath $guardScript validate-preset-file --root $RootPath --path $f.FullName --quiet 2>&1
        if ($LASTEXITCODE -ne 0) {
          $msg = [string]($guardOut -join "`n")
          if ([string]::IsNullOrWhiteSpace($msg)) {
            $msg = "guard validation failed"
          }
          Write-Warning ("Skip unsafe user preset {0}: {1}" -f $f.Name, $msg)
          continue
        }
      }

      $rawText = Get-Content -Path $f.FullName -Raw -Encoding UTF8
      $obj = $rawText | ConvertFrom-Json -ErrorAction Stop
      if ($null -eq $obj) { continue }

      $name = [string]$obj.name
      $base = [string]$obj.base
      if ([string]::IsNullOrWhiteSpace($name)) {
        Write-Warning ("Skip user preset without name: {0}" -f $f.Name)
        continue
      }
      if ([string]::IsNullOrWhiteSpace($base)) {
        Write-Warning ("Skip user preset without base: {0}" -f $f.Name)
        continue
      }
      if ($BuiltinNames.ContainsKey($name)) {
        Write-Warning ("Skip user preset name collision with built-in profile: {0}" -f $name)
        continue
      }
      $overrides = ConvertTo-StringHashtable -InputObject $obj.overrides
      $out += @{
        name = $name
        base = $base
        overrides = $overrides
      }
    } catch {
      Write-Warning ("Failed to load user preset {0}: {1}" -f $f.Name, $_.Exception.Message)
    }
  }
  return $out
}

$builtinVariantNames = @{}
foreach ($variant in $variants) {
  $builtinVariantNames[[string]$variant.name] = $true
}
$userPresetVariants = Get-UserPresetVariants -RootPath $root -BuiltinNames $builtinVariantNames -PythonPath $python
if (@($userPresetVariants).Count -gt 0) {
  $variants += $userPresetVariants
  Write-Host ("Loaded user presets: {0}" -f @($userPresetVariants).Count)
}

$variantLookup = @{}
foreach ($variant in $variants) {
  $variantLookup[[string]$variant.name] = $variant
}

function Resolve-VariantOverrides {
  param(
    [string]$VariantName,
    [hashtable]$Stack
  )
  if ([string]::IsNullOrWhiteSpace($VariantName)) {
    throw "Empty variant name."
  }
  if ($Stack.ContainsKey($VariantName)) {
    throw ("Cyclic variant base chain detected: {0}" -f $VariantName)
  }
  if (-not $variantLookup.ContainsKey($VariantName)) {
    throw ("Unknown variant in base chain: {0}" -f $VariantName)
  }

  $Stack[$VariantName] = $true
  $variant = $variantLookup[$VariantName]
  $resolved = @{}

  $baseName = [string]($variant.base)
  if (-not [string]::IsNullOrWhiteSpace($baseName)) {
    $baseResolved = Resolve-VariantOverrides -VariantName $baseName -Stack $Stack
    foreach ($k in $baseResolved.Keys) {
      $resolved[[string]$k] = [string]$baseResolved[$k]
    }
  }

  $overrides = $variant.overrides
  if ($overrides) {
    foreach ($k in $overrides.Keys) {
      $resolved[[string]$k] = [string]$overrides[$k]
    }
  }
  $null = $Stack.Remove($VariantName)
  return $resolved
}

$selected = @()
if ($ProfileIds -and @($ProfileIds).Count -gt 0) {
  $wanted = @{}
  foreach ($rawId in @($ProfileIds)) {
    foreach ($piece in ([string]$rawId -split ',')) {
      $id = [string]$piece
      if ([string]::IsNullOrWhiteSpace($id)) { continue }
      $wanted[$id.Trim()] = $true
    }
  }
  if ($wanted.Count -eq 0) {
    throw "ProfileIds was provided but no valid ids were found."
  }
  foreach ($v in $variants) {
    if ($wanted.ContainsKey([string]$v.name)) {
      $selected += $v
    }
  }
  $selectedNames = @($selected | ForEach-Object { [string]$_.name })
  $missing = @($wanted.Keys | Where-Object { $_ -notin $selectedNames })
  if (@($missing).Count -gt 0) {
    throw ("Unknown profile ids: {0}" -f (@($missing) -join ', '))
  }
} else {
  $take = [int]$Count
  $defaultByCount = @{
    1 = @('mx11_baseline_adapted')
    2 = @('mx11_baseline_adapted', 'mx9_exit_tight')
    3 = @('mx11_baseline_adapted', 'mx9_exit_tight', 'mx10_exit_adaptive')
    4 = @('mx11_baseline_adapted', 'mx9_exit_tight', 'mx10_exit_adaptive', 'mx8_recover_flow')
  }
  if ($defaultByCount.ContainsKey($take)) {
    $selected = @()
    foreach ($id in @($defaultByCount[$take])) {
      if (-not $variantLookup.ContainsKey([string]$id)) {
        throw ("Default matrix profile missing: {0}" -f $id)
      }
      $selected += $variantLookup[[string]$id]
    }
  } else {
    $selected = @($variants | Select-Object -First $take)
  }
}

$take = @($selected).Count
if ($take -le 0) {
  throw "No matrix profiles selected."
}

$selectedResolved = @()
foreach ($v in $selected) {
  $id = [string]$v.name
  $resolved = Resolve-VariantOverrides -VariantName $id -Stack @{}
  $selectedResolved += [pscustomobject]@{
    name = $id
    overrides = $resolved
  }
}
$selected = $selectedResolved

$records = @()

for ($i = 0; $i -lt $selected.Count; $i++) {
  $v = $selected[$i]
  $id = $v.name
  $logDir = "logs/matrix/$id"
  $paperState = "trading/paper_state.$id.json"
  $blFile = "data/autotrade_blacklist.$id.json"
  $lastBlock = "data/last_block_base.$id.txt"
  $seenPairs = "data/seen_pairs_base.$id.json"
  $graceful = "data/graceful_stop.$id.signal"
  $candLog = "logs/matrix/$id/candidates.jsonl"
  $tradeDecisionLog = "logs/matrix/$id/trade_decisions.jsonl"
  $snapshotDir = "snapshots/$id"

  $envPath = Join-Path $envDir "$id.env"

  $lines = @(
    "BOT_INSTANCE_ID=$id",
    "RUN_TAG=$id",
    "LOG_DIR=$logDir",
    "PAPER_STATE_FILE=$paperState",
    "CANDIDATE_DECISIONS_LOG_FILE=$candLog",
    "TRADE_DECISIONS_LOG_FILE=$tradeDecisionLog",
    "SNAPSHOT_DIR=$snapshotDir",
    "AUTONOMOUS_CONTROL_DECISIONS_LOG_FILE=logs/matrix/$id/autonomy_decisions.jsonl",
    "AUTOTRADE_BLACKLIST_FILE=$blFile",
    "ONCHAIN_LAST_BLOCK_FILE=$lastBlock",
    "ONCHAIN_SEEN_PAIRS_FILE=$seenPairs",
    "GRACEFUL_STOP_FILE=$graceful"
  )
  foreach ($k in $v.overrides.Keys) {
    if ($k -in @('CANDIDATE_SHARD_MOD', 'CANDIDATE_SHARD_SLOT')) { continue }
    $lines += "$k=$($v.overrides[$k])"
  }
  if ($ShardMode -eq 'split') {
    # Optional strict split mode: each profile gets a unique shard.
    $lines += "CANDIDATE_SHARD_MOD=$take"
    $lines += "CANDIDATE_SHARD_SLOT=$i"
  } else {
    # Shared mode for fair A/B: all profiles see the same candidate stream.
    if ($v.overrides.ContainsKey('CANDIDATE_SHARD_MOD')) {
      $lines += "CANDIDATE_SHARD_MOD=$($v.overrides['CANDIDATE_SHARD_MOD'])"
    } else {
      $lines += "CANDIDATE_SHARD_MOD=1"
    }
    if ($v.overrides.ContainsKey('CANDIDATE_SHARD_SLOT')) {
      $lines += "CANDIDATE_SHARD_SLOT=$($v.overrides['CANDIDATE_SHARD_SLOT'])"
    } else {
      $lines += "CANDIDATE_SHARD_SLOT=0"
    }
  }
  $utf8NoBom = New-Object System.Text.UTF8Encoding($false)
  [System.IO.File]::WriteAllLines($envPath, $lines, $utf8NoBom)
  $gracefulAbs = Join-Path $root $graceful
  if (Test-Path $gracefulAbs) {
    Remove-Item -Force -ErrorAction SilentlyContinue $gracefulAbs
  }
  if ($Run -and [string]($v.overrides['PAPER_RESET_ON_START']) -eq 'true') {
    $paperStateAbs = Join-Path $root $paperState
    if (Test-Path $paperStateAbs) {
      Remove-Item -Force -ErrorAction SilentlyContinue $paperStateAbs
    }
  }

  $rec = [ordered]@{
    id = $id
    env_file = $envPath
    log_dir = $logDir
    paper_state_file = $paperState
    graceful_stop_file = $graceful
    overrides = $v.overrides
    pid = $null
    status = 'prepared'
  }

  if ($Run) {
    $psi = New-Object System.Diagnostics.ProcessStartInfo
    $psi.FileName = $python
    $psi.Arguments = 'main_local.py'
    $psi.WorkingDirectory = $root
    $psi.UseShellExecute = $false
    $psi.RedirectStandardOutput = $false
    $psi.RedirectStandardError = $false
    $psi.EnvironmentVariables['BOT_ENV_FILE'] = $envPath
    $psi.EnvironmentVariables['PYTHONIOENCODING'] = 'utf-8'
    $proc = [System.Diagnostics.Process]::Start($psi)
    if ($null -ne $proc) {
      $startedPid = [int]$proc.Id
      $alive = $false
      for ($n = 0; $n -lt 24; $n++) {
        Start-Sleep -Milliseconds 500
        if (Test-MainLocalProcess -ProcessId $startedPid) {
          $alive = $true
          break
        }
      }
      if ($alive) {
        $rec.pid = $startedPid
        $rec.status = 'running'
      } else {
        $rec.status = 'start_failed_or_exited'
      }
    } else {
      $rec.status = 'start_failed'
    }
  }

  $records += [pscustomobject]$rec
}

$aliveCount = 0
foreach ($r in $records) {
  $procIdInMeta = 0
  try { $procIdInMeta = [int]($r.pid) } catch { $procIdInMeta = 0 }
  if ($procIdInMeta -gt 0 -and (Test-MainLocalProcess -ProcessId $procIdInMeta)) {
    $aliveCount += 1
  }
}

$meta = [ordered]@{
  created_at = (Get-Date).ToString('s')
  count = $take
  candidate_shard_mode = [string]$ShardMode
  requested_run = [bool]$Run
  running = [bool]($aliveCount -gt 0)
  alive_count = $aliveCount
  items = $records
}

$metaPath = Join-Path $runDir 'active_matrix.json'
$metaJson = $meta | ConvertTo-Json -Depth 8
$utf8NoBom = New-Object System.Text.UTF8Encoding($false)
[System.IO.File]::WriteAllText($metaPath, $metaJson, $utf8NoBom)

Write-Host "Matrix prepared: $metaPath"
if ($Run) {
  Write-Host "Started instances:"
  $records | ForEach-Object { Write-Host ("  {0} pid={1} status={2}" -f $_.id, $_.pid, $_.status) }
  Write-Host ("Alive instances: {0}/{1}" -f $aliveCount, $take)
} else {
  Write-Host "Use -Run to start instances."
}

